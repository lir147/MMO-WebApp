<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>RPG Game</title>
<style>
  body{font-family:sans-serif; background:#f0f0f0; margin:0; padding:0;}
  #game{padding:20px;}
  .hidden{display:none;}
  #characterImage{position:relative;width:150px;height:150px;margin-bottom:20px;}
  #inventory img{width:50px;height:50px;margin:2px;}
  #battleLog{height:150px;overflow:auto;border:1px solid #000;padding:5px;background:#fff;}
  button{margin:5px;}
</style>
</head>
<body>
<div id="game">
  <div id="createCharacter">
    <h2>Создать персонажа</h2>
    <select id="classSelect">
      <option value="warrior">Воин</option>
      <option value="mage">Маг</option>
      <option value="archer">Лучник</option>
      <option value="assassin">Ассасин</option>
    </select>
    <button onclick="createCharacter()">Создать</button>
  </div>

  <div id="mainGame" class="hidden">
    <div id="characterImage"></div>
    <div id="stats"></div>
    <button onclick="moveLocation()">Перейти в локацию</button>
    <button onclick="getQuest()">Получить задание</button>
    <h3>Инвентарь</h3>
    <div id="inventory"></div>
    <h3>Бой</h3>
    <button onclick="fightMonster()">Сражение с монстром</button>
    <div id="battleLog"></div>
  </div>
</div>

<script>
// ----- Игрок -----
let player = null;
let currentLocation = 0;

const classes = {
  warrior:{hp:100, attack:10, crit:5, speed:5, mana:0},
  mage:{hp:70, attack:5, crit:5, speed:5, mana:50},
  archer:{hp:80, attack:8, crit:10, speed:7, mana:0},
  assassin:{hp:75, attack:12, crit:15, speed:10, mana:0}
};

const equipment = {
  warrior:{weapon:['Меч','Топор'], armor:['Щит','Броня']},
  mage:{weapon:['Посох','Книга'], armor:['Мантия','Роба']},
  archer:{weapon:['Лук','Арбалет'], armor:['Кожаная броня','Плащ']},
  assassin:{weapon:['Кинжал','Короткий меч'], armor:['Легкая броня','Маска']}
};

// ----- Локации и монстры -----
const locations = [
  {name:'Лесная тропа', monsters:['Гоблин','Волк']},
  {name:'Подземелье', monsters:['Паук','Скелет']},
  {name:'Таверна', monsters:[]}
];

const quests = {
  'Лесная тропа': [{name:'Убей 3 гоблинов', reward:{exp:20, gold:10, item:{name:'Деревянный меч', type:'weapon', rarity:'common'}}}],
  'Подземелье': [{name:'Убей пауков', reward:{exp:25, gold:15}}]
};

// ----- Сохранение -----
function savePlayer(){ localStorage.setItem('rpgPlayer',JSON.stringify(player)); }
function loadPlayer(){
  const p = localStorage.getItem('rpgPlayer');
  if(p){ player=JSON.parse(p); showMainGame(); updateStatsUI(); updateInventoryUI(); updateCharacterDisplay(); }
}
loadPlayer();

// ----- Создание -----
function createCharacter(){
  const cls = document.getElementById('classSelect').value;
  const stats = classes[cls];
  player = {
    class:cls,
    level:1,
    exp:0,
    hp:stats.hp,
    attack:stats.attack,
    crit:stats.crit,
    speed:stats.speed,
    mana:stats.mana,
    inventory:[],
    weapon:null,
    armor:null,
    gold:0
  };
  savePlayer();
  showMainGame();
  updateStatsUI();
  updateCharacterDisplay();
}

// ----- UI -----
function showMainGame(){
  document.getElementById('createCharacter').classList.add('hidden');
  document.getElementById('mainGame').classList.remove('hidden');
}

function updateStatsUI(){
  const statsDiv=document.getElementById('stats');
  statsDiv.innerHTML = `
    Класс: ${player.class}<br>
    Уровень: ${player.level} | EXP: ${player.exp}<br>
    HP: ${player.hp}<br>
    Атака: ${player.attack} | Крит: ${player.crit} | Скорость: ${player.speed} | Мана: ${player.mana}<br>
    Золото: ${player.gold}
  `;
}

function updateInventoryUI(){
  const inv=document.getElementById('inventory');
  inv.innerHTML='';
  player.inventory.forEach(item=>{
    const img=document.createElement('img');
    img.src=`icons/${item.name}.png`;
    img.title=`${item.name} (${item.rarity||'common'})`;
    inv.appendChild(img);
  });
}

// ----- Визуализация персонажа -----
function updateCharacterDisplay(){
  const div=document.getElementById('characterImage');
  div.innerHTML='';

  const charDiv=document.createElement('div');
  charDiv.style.width='100%'; charDiv.style.height='100%';
  charDiv.style.background=`url('icons/${player.class}.png') center/contain no-repeat`;
  div.appendChild(charDiv);

  if(player.weapon){
    const wDiv=document.createElement('div');
    wDiv.style.width='100%'; wDiv.style.height='100%'; wDiv.style.position='absolute';
    wDiv.style.background=`url('icons/${player.weapon}.png') center/contain no-repeat`;
    div.appendChild(wDiv);
  }

  if(player.armor){
    const aDiv=document.createElement('div');
    aDiv.style.width='100%'; aDiv.style.height='100%'; aDiv.style.position='absolute';
    aDiv.style.background=`url('icons/${player.armor}.png') center/contain no-repeat`;
    div.appendChild(aDiv);
  }
}

// ----- Передвижение -----
function moveLocation(){
  currentLocation = (currentLocation+1) % locations.length;
  alert(`Вы перешли в локацию: ${locations[currentLocation].name}`);
}

// ----- Задания -----
function getQuest(){
  const locName = locations[currentLocation].name;
  const questList = quests[locName] || [];
  if(questList.length===0){ alert('Нет доступных заданий'); return; }
  const quest = questList[Math.floor(Math.random()*questList.length)];
  alert(`Задание: ${quest.name}`);
  rewardQuest(quest.reward);
}

function rewardQuest(reward){
  if(reward.exp) player.exp += reward.exp;
  if(reward.gold) player.gold += reward.gold;
  if(reward.item) player.inventory.push(reward.item);
  updateStatsUI();
  updateInventoryUI();
  savePlayer();
}

// ----- Бой -----
function fightMonster(){
  const loc = locations[currentLocation];
  if(loc.monsters.length===0){ alert('Здесь нет монстров'); return; }
  const monster = loc.monsters[Math.floor(Math.random()*loc.monsters.length)];
  const level = Math.floor(Math.random()*5)+1;
  let monsterHP = 20*level;
  addBattleLog(`Встречен ${monster} уровня ${level} с ${monsterHP} HP`);

  const damage = player.attack + Math.floor(Math.random()*5);
  monsterHP -= damage;
  addBattleLog(`Вы нанесли ${damage} урона. Осталось HP монстра: ${monsterHP}`);

  const monsterAttack = 5*level;
  player.hp -= monsterAttack;
  addBattleLog(`Монстр атакует! Урон: ${monsterAttack}. Ваше HP: ${player.hp}`);

  if(player.hp<=0){ alert('Вы погибли!'); localStorage.removeItem('rpgPlayer'); location.reload(); return; }

  if(monsterHP<=0){
    addBattleLog(`${monster} побежден! Вы получаете ${level*2} опыта`);
    player.exp += level*2;
    savePlayer();
    updateStatsUI();
  }
}

function addBattleLog(msg){
  const log=document.getElementById('battleLog');
  log.innerHTML += msg+'<br>';
  log.scrollTop = log.scrollHeight;
}

// ----- Вспомогательные -----
function randomInt(min,max){ return Math.floor(Math.random()*(max-min+1))+min; }
</script>
</body>
</html>
