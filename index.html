<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>Telegram Mini-MMORPG</title>
<style>
body { font-family: Arial; background:#111; color:#fff; text-align:center; }
#game { margin:20px auto; width:400px; height:400px; border:2px solid #fff; border-radius:10px; background:#222; position:relative; overflow:hidden; }
.tile { width:80px; height:80px; float:left; border:1px solid #444; background-size:cover; position:relative; }
.character, .monster, .loot, .shop { width:60px; height:60px; position:absolute; transition:all 0.3s ease; }
.character img, .monster img, .loot img, .shop img { width:100%; height:100%; }
#status { margin-top:10px; border:1px solid #fff; padding:5px; text-align:left; }
.bar { width:100%; height:15px; background:#444; border-radius:5px; margin:2px 0; position:relative; }
.bar-fill { height:100%; background:#0f0; width:0%; border-radius:5px; }
#inventory { margin-top:10px; }
.item { width:50px; height:50px; margin:5px; display:inline-block; background-size:cover; border:1px solid #fff; border-radius:5px; cursor:pointer; }
#log { height:120px; overflow-y:auto; border:1px solid #fff; padding:5px; text-align:left; }
button { margin:5px; padding:8px 12px; }
.hidden { display:none; }
#gameControls { margin-top:10px; }
#skillTreeModal { position:fixed; top:50%; left:50%; transform:translate(-50%,-50%);
    background:#222; border:2px solid #fff; padding:20px; z-index:100; width:300px; max-height:400px; overflow:auto; }
</style>
</head>
<body>

<h2>Telegram Mini-MMORPG</h2>

<!-- –í—ã–±–æ—Ä –∫–ª–∞—Å—Å–∞ –∏ –ø–æ–ª–∞ -->
<div id="classGenderSelection">
    <div>–ö–ª–∞—Å—Å:
        <button onclick="selectClass('Warrior')">–í–æ–∏–Ω</button>
        <button onclick="selectClass('Mage')">–ú–∞–≥</button>
        <button onclick="selectClass('Archer')">–õ—É—á–Ω–∏–∫</button>
    </div>
    <div>–ü–æ–ª:
        <button onclick="selectGender('male')">–ú—É–∂—Å–∫–æ–π</button>
        <button onclick="selectGender('female')">–ñ–µ–Ω—Å–∫–∏–π</button>
    </div>
</div>

<div id="game" class="hidden"></div>

<div id="status" class="hidden">
    HP: <div class="bar"><div class="bar-fill" id="hpFill"></div></div>
    MP: <div class="bar"><div class="bar-fill" id="mpFill"></div></div>
    EXP: <div class="bar"><div class="bar-fill" id="expFill"></div></div>
    Level: <span id="levelDisplay">1</span>
    VIP —É—Ä–æ–≤–µ–Ω—å: <span id="vipDisplay">0</span>
    –ú–æ–Ω–µ—Ç—ã: <span id="coinsDisplay">0</span>
</div>

<div id="inventory" class="hidden"></div>
<div id="log" class="hidden"></div>

<div id="gameControls" class="hidden">
    <button onclick="donate()">üíé –ü–æ–ø–æ–ª–Ω–∏—Ç—å —Å—á—ë—Ç (+VIP)</button>
    <button onclick="openSkillTree()">üßô –û—Ç–∫—Ä—ã—Ç—å –¥—Ä–µ–≤–æ –Ω–∞–≤—ã–∫–æ–≤</button>
</div>

<div id="skillTreeModal" class="hidden">
    <h3>–î—Ä–µ–≤–æ –Ω–∞–≤—ã–∫–æ–≤</h3>
    <div id="skillsList"></div>
    <div>–û—á–∫–∏ –Ω–∞–≤—ã–∫–æ–≤: <span id="skillPoints">0</span></div>
    <button onclick="closeSkillTree()">–ó–∞–∫—Ä—ã—Ç—å</button>
</div>

<script>
// –ò–≥—Ä–æ–∫
let player = {
    x:2,y:2,hp:100,maxHp:100,mp:50,maxMp:50,exp:0,nextLevelExp:100,
    level:1,coins:0,vipLevel:0,inventory:[],equipment:{weapon:null,shield:null,armor:null},
    class:'',gender:'',skillPoints:0, skills:{strength:0,agility:0,intelligence:0}
};

// –ö–∞—Ä—Ç–∞
const mapDiv=document.getElementById("game");
const tileSize=80;
let mapTiles=[];
for(let y=0;y<5;y++){
    mapTiles[y]=[];
    for(let x=0;x<5;x++){
        const tile=document.createElement("div");
        tile.className="tile";
        tile.style.backgroundImage="url('https://i.imgur.com/Nl1lG2p.png')";
        tile.style.left=x*tileSize+"px";
        tile.style.top=y*tileSize+"px";
        mapDiv.appendChild(tile);
        mapTiles[y][x]=tile;
    }
}

// –ü–µ—Ä—Å–æ–Ω–∞–∂
const characterDiv=document.createElement("div");
characterDiv.className="character";
characterDiv.style.left=player.x*tileSize+10+"px";
characterDiv.style.top=player.y*tileSize+10+"px";
mapDiv.appendChild(characterDiv);

// –õ–æ–≥
function log(msg){ const logDiv=document.getElementById("log"); logDiv.innerHTML+=msg+"<br>"; logDiv.scrollTop=logDiv.scrollHeight; }

// –°—Ç–∞—Ç—É—Å—ã
function updateStatus(){
    document.getElementById("hpFill").style.width=(player.hp/player.maxHp*100)+"%";
    document.getElementById("mpFill").style.width=(player.mp/player.maxMp*100)+"%";
    document.getElementById("expFill").style.width=(player.exp/player.nextLevelExp*100)+"%";
    document.getElementById("levelDisplay").innerText=player.level;
    document.getElementById("vipDisplay").innerText=player.vipLevel;
    document.getElementById("coinsDisplay").innerText=player.coins;
}

// –ò–Ω–≤–µ–Ω—Ç–∞—Ä—å
function updateInventory(){
    const invDiv=document.getElementById("inventory");
    invDiv.innerHTML="";
    for(let key in player.equipment){
        if(player.equipment[key]){
            const div=document.createElement("div");
            div.className="item";
            div.style.backgroundImage=`url(${player.equipment[key].img})`;
            div.title=player.equipment[key].name;
            invDiv.appendChild(div);
        }
    }
}

// –í—ã–±–æ—Ä –∫–ª–∞—Å—Å–∞ –∏ –ø–æ–ª–∞
function selectClass(cls){ player.class=cls; checkSelectionComplete(); }
function selectGender(g){ player.gender=g; checkSelectionComplete(); }

function checkSelectionComplete(){
    if(player.class && player.gender){
        document.getElementById("classGenderSelection").classList.add("hidden");
        mapDiv.classList.remove("hidden");
        document.getElementById("status").classList.remove("hidden");
        document.getElementById("inventory").classList.remove("hidden");
        document.getElementById("log").classList.remove("hidden");
        document.getElementById("gameControls").classList.remove("hidden");
        updateCharacterImage();
        initGameObjects();
        log(`–í—ã –≤—ã–±—Ä–∞–ª–∏: ${player.class}, –ø–æ–ª: ${player.gender}`);
    }
}

// –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–∞—Ä—Ç–∏–Ω–∫–∏ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞
function updateCharacterImage(){
    let img='https://i.imgur.com/4c6wqdn.png';
    if(player.class=='Mage') img='https://i.imgur.com/5Uq2KHu.png';
    if(player.class=='Archer') img='https://i.imgur.com/1vTtOkM.png';
    if(player.gender=='female'){
        if(player.class=='Warrior') img='https://i.imgur.com/3tY7aLp.png';
        if(player.class=='Mage') img='https://i.imgur.com/ZtFJqP1.png';
        if(player.class=='Archer') img='https://i.imgur.com/vl4oZT6.png';
    }
    characterDiv.innerHTML=`<img src="${img}">`;
}

// –û–±—ä–µ–∫—Ç—ã –∏–≥—Ä—ã
let monsters=[],loots=[],shops=[];
let monstersData = [
    {x:0, y:0, name:"–ì–æ–±–ª–∏–Ω", hp:50, maxHp:50, exp:20, coins:10, img:"https://i.imgur.com/EhFz7ON.png"},
    {x:4, y:4, name:"–û—Ä–∫", hp:100, maxHp:100, exp:50, coins:30, img:"https://i.imgur.com/2aXlQ9m.png"},
    {x:1, y:3, name:"–°–∫–µ–ª–µ—Ç", hp:40, maxHp:40, exp:15, coins:5, img:"https://i.imgur.com/XtZ0OiB.png"}
];

function spawnLoot(x,y,img="https://i.imgur.com/OY8o0jA.png",type="weapon",name="–ú–µ—á"){
    const div=document.createElement("div"); div.className="loot"; div.style.left=x*tileSize+10+"px"; div.style.top=y*tileSize+10+"px";
    div.innerHTML=`<img src="${img}">`; div.onclick=()=>{ if(type=="weapon"||type=="shield"){ player.equipment[type]={name,img}; updateInventory(); } log(`–ü–æ–¥–æ–±—Ä–∞–Ω–æ ${name}`); div.remove(); }; mapDiv.appendChild(div); loots.push({x,y,div});
}

function spawnShop(x,y,img="https://i.imgur.com/7c3tN2B.png"){
    const div=document.createElement("div"); div.className="shop"; div.style.left=x*tileSize+10+"px"; div.style.top=y*tileSize+10+"px"; div.innerHTML=`<img src="${img}">`;
    div.onclick=()=>{ const choice=prompt("–ö—É–ø–∏—Ç—å: 1-HP 2-MP (10 –º–æ–Ω–µ—Ç)"); if(choice=="1" && player.coins>=10){player.coins-=10;player.hp=Math.min(player.maxHp,player.hp+50); log("üíñ –ö—É–ø–ª–µ–Ω–æ HP");} else if(choice=="2" && player.coins>=10){player.coins-=10;player.mp=Math.min(player.maxMp,player.mp+30); log("üîÆ –ö—É–ø–ª–µ–Ω–æ MP");} else log("–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –º–æ–Ω–µ—Ç"); updateStatus(); }; mapDiv.appendChild(div); shops.push({x,y,div});
}

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –º–æ–Ω—Å—Ç—Ä–æ–≤
function initMonsters(){
    monstersData.forEach(m=>{
        const div=document.createElement("div");
        div.className="monster";
        div.style.left=m.x*tileSize+10+"px";
        div.style.top=m.y*tileSize+10+"px";
        div.innerHTML=`<img src="${m.img}">`;
        mapDiv.appendChild(div);
        m.div=div;
        monsters.push(m);
    });
}

// –ê—Ç–∞–∫–∞ –∏ –±–æ–π
function attackMonster(monster){
    let damage = Math.floor(Math.random() * 20 + 5 + player.skills.strength*2);
    monster.hp -= damage;
    showDamage(monster, damage);
    log(`üí• –í—ã –Ω–∞–Ω–µ—Å–ª–∏ ${damage} —É—Ä–æ–Ω–∞ ${monster.name}`);
    if(monster.hp <= 0){
        log(`üíÄ ${monster.name} –ø–æ–±–µ–∂–¥—ë–Ω! –ü–æ–ª—É—á–µ–Ω–æ ${monster.exp} XP –∏ ${monster.coins} –º–æ–Ω–µ—Ç`);
        player.exp += monster.exp;
        player.coins += monster.coins;
        dropLoot(monster.x, monster.y);
        monster.div.remove();
        monsters = monsters.filter(m=>m!==monster);
        checkLevelUp();
        updateStatus();
    } else {
        setTimeout(()=>monsterAttack(monster),300);
    }
}

function monsterAttack(monster){
    let damage = Math.floor(Math.random() * 15 + 5);
    player.hp -= damage;
    if(player.hp<0) player.hp=0;
    log(`üëπ ${monster.name} –Ω–∞–Ω–æ—Å–∏—Ç ${damage} —É—Ä–æ–Ω–∞`);
    updateStatus();
}

function showDamage(monster, dmg){
    const dmgDiv=document.createElement("div");
    dmgDiv.className="damage";
    dmgDiv.innerText=dmg;
    dmgDiv.style.left=monster.x*tileSize+20+"px";
    dmgDiv.style.top=monster.y*tileSize-10+"px";
    mapDiv.appendChild(dmgDiv);
    setTimeout(()=>dmgDiv.remove(),1000);
}

function dropLoot(x,y){
    let chance = Math.random();
    if(chance <0.5){
        spawnLoot(x,y,"https://i.imgur.com/OY8o0jA.png","weapon","–ú–µ—á");
    } else if(chance <0.8){
        spawnLoot(x,y,"https://i.imgur.com/7c3tN2B.png","hp","–ó–µ–ª—å–µ HP");
    }
}

// –ü–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ
function moveTo(x,y){
    if(x<0||y<0||x>4||y>4) return;
    player.x=x; player.y=y;
    characterDiv.style.left=x*tileSize+10+"px";
    characterDiv.style.top=y*tileSize+10+"px";
    monsters.forEach(m=>{ if(m.x==x && m.y==y){ attackMonster(m); } });
    loots.forEach(l=>{ if(l.x==x && l.y==y){ log("‚ú® –†—è–¥–æ–º –ª—É—Ç!"); } });
    shops.forEach(s=>{ if(s.x==x && s.y==y){ log("üè™ –†—è–¥–æ–º –º–∞–≥–∞–∑–∏–Ω!"); } });
}

// –î–æ–Ω–∞—Ç –∏ VIP
function donate(){
    let amount = prompt("–í–≤–µ–¥–∏—Ç–µ —Å—É–º–º—É –ø–æ–ø–æ–ª–Ω–µ–Ω–∏—è (—Ä—É–±):");
    amount = parseInt(amount);
    if(!amount || amount<=0) return;
    let vipGain = Math.floor(amount/100);
    player.vipLevel += vipGain;
    player.coins += amount;
    log(`üíé –î–æ–Ω–∞—Ç ${amount} –ø–æ–ª—É—á–µ–Ω–æ! VIP +${vipGain}, –º–æ–Ω–µ—Ç—ã +${amount}`);
    updateStatus();
}

// –î—Ä–µ–≤–æ –Ω–∞–≤—ã–∫–æ–≤
function openSkillTree(){
    document.getElementById("skillTreeModal").classList.remove("hidden");
    updateSkillTree();
}
function closeSkillTree(){
    document.getElementById("skillTreeModal").classList.add("hidden");
}
function updateSkillTree(){
    const skillsDiv = document.getElementById("skillsList");
    skillsDiv.innerHTML="";
    document.getElementById("skillPoints").innerText = player.skillPoints;
    for(let key in player.skills){
        let div = document.createElement("div");
        div.innerHTML = `${key.toUpperCase()}: ${player.skills[key]}
            <button onclick="upgradeSkill('${key}')">+</button>`;
        skillsDiv.appendChild(div);
    }
}
function upgradeSkill(skill){
    if(player.skillPoints<=0) return;
    player.skills[skill] +=1;
    player.skillPoints -=1;
    log(`üÜô –ù–∞–≤—ã–∫ ${skill.toUpperCase()} –ø–æ–≤—ã—à–µ–Ω –¥–æ ${player.skills[skill]}`);
    updateSkillTree();
}

// –ü—Ä–æ–≤–µ—Ä–∫–∞ —É—Ä–æ–≤–Ω—è
function checkLevelUp(){
    while(player.exp >= player.nextLevelExp){
        player.exp -= player.nextLevelExp;
        player.level +=1;
        player.maxHp += 20;
        player.hp = player.maxHp;
        player.maxMp +=10;
        player.mp = player.maxMp;
        player.nextLevelExp = Math.floor(player.nextLevelExp *1.5);
        player.skillPoints += 3;
        log(`‚≠ê –ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º! –í—ã –¥–æ—Å—Ç–∏–≥–ª–∏ —É—Ä–æ–≤–Ω—è ${player.level}, –ø–æ–ª—É—á–µ–Ω–æ 3 –æ—á–∫–∞ –Ω–∞–≤—ã–∫–æ–≤`);
        updateStatus();
        updateSkillTree();
    }
}

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏–≥—Ä—ã
function initGameObjects(){
    initMonsters();
    spawnLoot(2,1,"https://i.imgur.com/OY8o0jA.png","weapon","–ú–µ—á");
    spawnLoot(3,2,"https://i.imgur.com/7c3tN2B.png","hp","–ó–µ–ª—å–µ HP");
    spawnShop(2,0,"https://i.imgur.com/7c3tN2B.png");
    updateInventory();
    updateStatus();
}

// –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–ª–∞–≤–∏—à–∞–º–∏
document.addEventListener("keydown", (e)=>{
    if(e.key=="ArrowUp") moveTo(player.x, player.y-1);
    if(e.key=="ArrowDown") moveTo(player.x, player.y+1);
    if(e.key=="ArrowLeft") moveTo(player.x-1, player.y);
    if(e.key=="ArrowRight") moveTo(player.x+1, player.y);
});

</script>
</body>
</html>
