<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>Mini-RPG Mobile</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body { font-family: Arial; background:#111; color:#fff; text-align:center; margin:0; padding:0; }
#game { margin:10px auto; width:95vw; height:50vh; border:2px solid #fff; border-radius:10px; background:#222; position:relative; overflow:hidden; background-image: url('https://i.imgur.com/4vXK9pS.png'); background-size: cover; }
.character, .monster, .loot { width:50px; height:50px; position:absolute; transition:all 0.2s ease; }
.character img, .monster img, .loot img { width:100%; height:100%; }
#status { margin:5px; border:1px solid #fff; padding:5px; font-size:14px; text-align:left; }
.bar { width:100%; height:10px; background:#444; border-radius:5px; margin:2px 0; position:relative; }
.bar-fill { height:100%; background:#0f0; width:0%; border-radius:5px; }
#inventory { margin-top:5px; display:flex; justify-content:center; flex-wrap:wrap; }
.item { width:40px; height:40px; margin:3px; background-size:cover; border:1px solid #fff; border-radius:5px; cursor:pointer; position:relative; }
.item span { position:absolute; bottom:0; left:0; right:0; background:#0008; font-size:9px; }
#log { height:80px; overflow-y:auto; border:1px solid #fff; padding:3px; text-align:left; font-size:12px; }
button { margin:3px; padding:6px 8px; font-size:14px; border-radius:5px; }
.hidden { display:none; }
#gameControls { margin-top:5px; }
#skillTreeModal { position:fixed; top:50%; left:50%; transform:translate(-50%,-50%);
    background:#222; border:2px solid #fff; padding:15px; z-index:100; width:90%; max-width:300px; max-height:60%; overflow:auto; font-size:14px; }
</style>
</head>
<body>

<h2>Mini-RPG Mobile</h2>

<div id="game"></div>

<div id="status">
HP: <div class="bar"><div class="bar-fill" id="hpFill"></div></div>
MP: <div class="bar"><div class="bar-fill" id="mpFill"></div></div>
EXP: <div class="bar"><div class="bar-fill" id="expFill"></div></div>
Level: <span id="levelDisplay">1</span> | VIP: <span id="vipDisplay">0</span> | Coins: <span id="coinsDisplay">0</span>
</div>

<div id="inventory" title="–ò–Ω–≤–µ–Ω—Ç–∞—Ä—å"></div>
<div id="log"></div>

<div id="gameControls">
<button onclick="donate()">üíé –î–æ–Ω–∞—Ç / –ü–æ–ø–æ–ª–Ω–∏—Ç—å</button>
<button onclick="openSkillTree()">üßô –î—Ä–µ–≤–æ –Ω–∞–≤—ã–∫–æ–≤</button>
</div>

<div id="skillTreeModal" class="hidden">
<h3>–î—Ä–µ–≤–æ –Ω–∞–≤—ã–∫–æ–≤</h3>
<div id="skillsList"></div>
<div>–û—á–∫–∏ –Ω–∞–≤—ã–∫–æ–≤: <span id="skillPoints">0</span></div>
<button onclick="closeSkillTree()">–ó–∞–∫—Ä—ã—Ç—å</button>
</div>

<script>
// –ò–≥—Ä–æ–∫
let player = {
    x:160, y:160, hp:100, maxHp:100, mp:50, maxMp:50,
    exp:0, nextLevelExp:100, level:1, coins:0, vipLevel:0, firstTopup:true,
    inventory:[], equipment:{weapon:null, armor:null, shield:null},
    skillPoints:0, skills:{strength:0, agility:0, intelligence:0}
};

// –ü–µ—Ä—Å–æ–Ω–∞–∂
const mapDiv = document.getElementById("game");
const charDiv=document.createElement("div"); charDiv.className="character"; mapDiv.appendChild(charDiv);
const charBase=document.createElement("img"); charBase.src="https://i.imgur.com/4c6wqdn.png"; charDiv.appendChild(charBase);
const charWeapon=document.createElement("img"); charDiv.appendChild(charWeapon);
const charArmor=document.createElement("img"); charDiv.appendChild(charArmor);
const charShield=document.createElement("img"); charDiv.appendChild(charShield);

function log(msg){ const l=document.getElementById("log"); l.innerHTML+=msg+"<br>"; l.scrollTop=l.scrollHeight; }
function updateStatus(){
    document.getElementById("hpFill").style.width=(player.hp/player.maxHp*100)+"%";
    document.getElementById("mpFill").style.width=(player.mp/player.maxMp*100)+"%";
    document.getElementById("expFill").style.width=(player.exp/player.nextLevelExp*100)+"%";
    document.getElementById("levelDisplay").innerText=player.level;
    document.getElementById("vipDisplay").innerText=player.vipLevel;
    document.getElementById("coinsDisplay").innerText=player.coins;
}
function updateCharacterView(){
    charDiv.style.left=player.x+"px"; charDiv.style.top=player.y+"px";
    charWeapon.src = player.equipment.weapon ? player.equipment.weapon.img : '';
    charArmor.src = player.equipment.armor ? player.equipment.armor.img : '';
    charShield.src = player.equipment.shield ? player.equipment.shield.img : '';
}

// –ò–Ω–≤–µ–Ω—Ç–∞—Ä—å
const invDiv=document.getElementById("inventory");
function updateInventory(){
    invDiv.innerHTML="";
    player.inventory.forEach((item,idx)=>{
        const div=document.createElement("div");
        div.className="item"; div.style.backgroundImage=`url(${item.img})`;
        div.title=`${item.name}\n${item.bonus?JSON.stringify(item.bonus):''}`;
        div.innerHTML=`<span>${item.type}</span>`;
        div.onclick=()=>equipItem(idx);
        invDiv.appendChild(div);
    });
}

function equipItem(index){
    const item=player.inventory[index];
    player.equipment[item.type]=item;
    updateCharacterView();
}

// –õ—É—Ç —Å —Ä–µ–¥–∫–æ—Å—Ç—å—é
function generateLoot(){
    const rarityTable=[
        {name:"–ú–µ—á –Ω–æ–≤–∏—á–∫–∞", type:"weapon", img:"https://i.imgur.com/OY8o0jA.png", rarity:"common", bonus:{strength:1}},
        {name:"–î–æ—Å–ø–µ—Ö —Ä–µ–¥–∫–∏–π", type:"armor", img:"https://i.imgur.com/7c3tN2B.png", rarity:"rare", bonus:{hp:20}},
        {name:"–©–∏—Ç —ç–ø–∏—á–µ—Å–∫–∏–π", type:"shield", img:"https://i.imgur.com/8hG8fXQ.png", rarity:"epic", bonus:{crit:5}},
        {name:"–ú–µ—á –ª–µ–≥–µ–Ω–¥–∞—Ä–Ω—ã–π", type:"weapon", img:"https://i.imgur.com/ZtFJqP1.png", rarity:"legendary", bonus:{strength:5, crit:10}}
    ];
    const roll=Math.random();
    let item;
    if(roll<0.5) item=rarityTable[0];
    else if(roll<0.75) item=rarityTable[1];
    else if(roll<0.9) item=rarityTable[2];
    else item=rarityTable[3];
    player.inventory.push(item);
    log(`üéÅ –í—ã–ø–∞–ª –ª—É—Ç: ${item.name} (${item.rarity})`);
    updateInventory();
}

// –î–æ–Ω–∞—Ç —Å –±–æ–Ω—É—Å–∞–º–∏
function donate(){
    let amount=parseInt(prompt("–í–≤–µ–¥–∏—Ç–µ —Å—É–º–º—É –ø–æ–ø–æ–ª–Ω–µ–Ω–∏—è:"));
    if(!amount||amount<=0) return;
    player.coins+=amount;
    if(player.firstTopup){
        player.firstTopup=false;
        const bonusItem={name:"–ú–µ—á –Ω–æ–≤–∏—á–∫–∞+1", type:"weapon", img:"https://i.imgur.com/OY8o0jA.png", rarity:"legendary", bonus:{strength:5, crit:5}};
        player.inventory.push(bonusItem);
        log("üéâ –ü–µ—Ä–≤–æ–µ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏–µ! –ü–æ–ª—É—á–µ–Ω –±–æ–Ω—É—Å: "+bonusItem.name);
    }
    const vipGain=Math.floor(amount/100);
    player.vipLevel+=vipGain;
    player.exp+=vipGain*10; // VIP –±–æ–Ω—É—Å –∫ –æ–ø—ã—Ç—É
    log(`üíé –î–æ–Ω–∞—Ç: ${amount}, VIP +${vipGain}, EXP +${vipGain*10}`);
    updateInventory(); updateStatus();
}

// –ù–∞–≤—ã–∫–∏
function openSkillTree(){ document.getElementById("skillTreeModal").classList.remove("hidden"); updateSkillTree(); }
function closeSkillTree(){ document.getElementById("skillTreeModal").classList.add("hidden"); }
function updateSkillTree(){
    const skillsDiv=document.getElementById("skillsList"); skillsDiv.innerHTML="";
    document.getElementById("skillPoints").innerText=player.skillPoints;
    for(let key in player.skills){
        let div=document.createElement("div");
        div.innerHTML=`${key.toUpperCase()}: ${player.skills[key]} <button onclick="upgradeSkill('${key}')">+</button>`;
        skillsDiv.appendChild(div);
    }
}
function upgradeSkill(skill){ if(player.skillPoints<=0) return; player.skills[skill]+=1; player.skillPoints-=1; log(`üÜô ${skill.toUpperCase()} +1`); updateSkillTree(); }

// –¢–µ—Å—Ç–æ–≤—ã–µ –∫–Ω–æ–ø–∫–∏
setInterval(generateLoot, 10000); // –∫–∞–∂–¥—ã–µ 10 —Å–µ–∫—É–Ω–¥ –ª—É—Ç –ø–∞–¥–∞–µ—Ç
updateCharacterView(); updateInventory(); updateStatus();
</script>

</body>
</html>
