<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<title>Mini-RPG Mobile</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<style>
  body {
    font-family: Arial, sans-serif;
    background: #111;
    color: #fff;
    text-align: center;
    margin: 0;
    padding: 0;
  }
  #game {
    margin: 10px auto;
    width: 95vw;
    height: 50vh;
    border: 2px solid #fff;
    border-radius: 10px;
    background: #222 url('https://opengameart.org/sites/default/files/tiny_roguelike_tilesheet.png') no-repeat center center;
    background-size: contain;
    position: relative;
    overflow: hidden;
  }

  .character,
  .monster,
  .loot {
    width: 48px;
    height: 48px;
    position: absolute;
    transition: all 0.2s ease;
  }

  .character img,
  .monster img,
  .loot img {
    width: 100%;
    height: 100%;
    image-rendering: pixelated;
  }

  #status {
    margin: 5px auto;
    width: 95vw;
    max-width: 600px;
    border: 1px solid #fff;
    padding: 8px;
    font-size: 14px;
    text-align: left;
  }

  .bar {
    width: 100%;
    height: 10px;
    background: #444;
    border-radius: 5px;
    margin: 5px 0;
    position: relative;
  }
  .bar-fill {
    height: 100%;
    background: #0f0;
    width: 0%;
    border-radius: 5px;
  }
  #mpFill {
    background: #06f;
  }
  #expFill {
    background: #ff0;
  }

  #inventory {
    margin: 10px auto;
    width: 95vw;
    max-width: 600px;
    display: flex;
    justify-content: flex-start;
    flex-wrap: wrap;
    border: 1px solid #fff;
    padding: 5px;
    background: #222;
    border-radius: 6px;
    cursor: default;
  }

  .item {
    width: 40px;
    height: 40px;
    margin: 4px;
    background-size: cover;
    border: 1px solid #fff;
    border-radius: 5px;
    position: relative;
  }
  .item span {
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
    background: #000c;
    font-size: 9px;
    color: #eee;
    user-select: none;
  }
  .item:hover {
    filter: brightness(1.3);
    cursor: pointer;
  }

  #log {
    height: 100px;
    max-width: 600px;
    margin: 10px auto;
    overflow-y: auto;
    border: 1px solid #fff;
    padding: 6px;
    font-size: 13px;
    text-align: left;
    background: #222;
    border-radius: 6px;
  }

  button {
    margin: 5px 8px;
    padding: 8px 12px;
    font-size: 16px;
    border-radius: 6px;
    border: none;
    background: #0066cc;
    color: #fff;
    cursor: pointer;
    transition: 0.25s;
    min-width: 120px;
  }
  button:hover {
    background: #004bb5;
  }

  #gameControls {
    margin-top: 10px;
  }

  #skillTreeModal {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background: #222;
    border: 2px solid #fff;
    padding: 15px;
    z-index: 100;
    width: 90%;
    max-width: 320px;
    max-height: 60%;
    overflow-y: auto;
    font-size: 14px;
    display: none;
  }

  #skillTreeModal.visible {
    display: block;
  }
</style>
</head>
<body>
  <h2>Mini-RPG Mobile</h2>
  <div id="game"></div>

  <div id="status">
    HP: <div class="bar"><div class="bar-fill" id="hpFill"></div></div>
    MP: <div class="bar"><div class="bar-fill" id="mpFill"></div></div>
    EXP: <div class="bar"><div class="bar-fill" id="expFill"></div></div>
    Level: <span id="levelDisplay">1</span> |
    VIP: <span id="vipDisplay">0</span> |
    Coins: <span id="coinsDisplay">0</span>
  </div>

  <div id="inventory" title="–í–∞—à –∏–Ω–≤–µ–Ω—Ç–∞—Ä—å: –∫–ª–∏–∫–Ω–∏—Ç–µ –¥–ª—è —ç–∫–∏–ø–∏—Ä–æ–≤–∫–∏"></div>

  <div id="log"></div>

  <div id="gameControls">
    <button onclick="donate()">üíé –ü–æ–ø–æ–ª–Ω–∏—Ç—å —Å—á—ë—Ç</button>
    <button onclick="openSkillTree()">üßô –î—Ä–µ–≤–æ –Ω–∞–≤—ã–∫–æ–≤</button>
  </div>

  <div id="skillTreeModal">
    <h3>–î—Ä–µ–≤–æ –Ω–∞–≤—ã–∫–æ–≤</h3>
    <div id="skillsList"></div>
    <div>–û—á–∫–∏ –Ω–∞–≤—ã–∫–æ–≤: <span id="skillPoints">0</span></div>
    <button onclick="closeSkillTree()">–ó–∞–∫—Ä—ã—Ç—å</button>
  </div>
<script>
// –ò–≥—Ä–æ–∫
let player = {
  x: 160,
  y: 160,
  hp: 100,
  maxHp: 100,
  mp: 50,
  maxMp: 50,
  exp: 0,
  nextLevelExp: 100,
  level: 1,
  coins: 0,
  vipLevel: 0,
  firstTopup: true,
  inventory: [],
  equipment: { weapon: null, armor: null, shield: null },
  skillPoints: 0,
  skills: { strength: 0, agility: 0, intelligence: 0 }
};

// –≠–ª–µ–º–µ–Ω—Ç—ã
const mapDiv = document.getElementById("game");

// –°–æ–∑–¥–∞—ë–º –ø–µ—Ä—Å–æ–Ω–∞–∂–∞
const charDiv = document.createElement("div");
charDiv.className = "character";
mapDiv.appendChild(charDiv);

const charBase = document.createElement("img");
charBase.src = "https://opengameart.org/sites/default/files/character_maleAdventurer_walk.png"; // –ø—Ä–∏–º–µ—Ä –∞–Ω–∏–º–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –∏–ª–∏ —Å—Ç–∞—Ç–∏—á–Ω–æ–≥–æ –≥–µ—Ä–æ—è
charDiv.appendChild(charBase);

const charWeapon = document.createElement("img");
charDiv.appendChild(charWeapon);

const charArmor = document.createElement("img");
charDiv.appendChild(charArmor);

const charShield = document.createElement("img");
charDiv.appendChild(charShield);

// –õ–æ–≥–∏
function log(msg) {
  const l = document.getElementById("log");
  l.innerHTML += msg + "<br>";
  l.scrollTop = l.scrollHeight;
}

// –°—Ç–∞—Ç—É—Å
function updateStatus() {
  document.getElementById("hpFill").style.width = (player.hp / player.maxHp) * 100 + "%";
  document.getElementById("mpFill").style.width = (player.mp / player.maxMp) * 100 + "%";
  document.getElementById("expFill").style.width = (player.exp / player.nextLevelExp) * 100 + "%";
  document.getElementById("levelDisplay").innerText = player.level;
  document.getElementById("vipDisplay").innerText = player.vipLevel;
  document.getElementById("coinsDisplay").innerText = player.coins;
}

// –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞ –∏ —ç–∫–∏–ø–∏—Ä–æ–≤–∫–∏
function updateCharacterView() {
  charDiv.style.left = player.x + "px";
  charDiv.style.top = player.y + "px";
  charWeapon.src = player.equipment.weapon ? player.equipment.weapon.img : "";
  charArmor.src = player.equipment.armor ? player.equipment.armor.img : "";
  charShield.src = player.equipment.shield ? player.equipment.shield.img : "";
}

// –ò–Ω–≤–µ–Ω—Ç–∞—Ä—å
const invDiv = document.getElementById("inventory");
function updateInventory() {
  invDiv.innerHTML = "";
  player.inventory.forEach((item, idx) => {
    const div = document.createElement("div");
    div.className = "item";
    div.style.backgroundImage = `url(${item.img})`;
    div.title = `${item.name}\n${item.bonus ? JSON.stringify(item.bonus) : ""}`;
    div.innerHTML = `<span>${item.type}</span>`;
    div.onclick = () => equipItem(idx);
    invDiv.appendChild(div);
  });
}
function equipItem(index) {
  const item = player.inventory[index];
  player.equipment[item.type] = item;
  log(`üõ° –≠–∫–∏–ø–∏—Ä–æ–≤–∞–Ω: ${item.name}`);
  updateCharacterView();
}

// –î–æ–Ω–∞—Ç
function donate() {
  let amount = parseInt(prompt("–í–≤–µ–¥–∏—Ç–µ —Å—É–º–º—É –ø–æ–ø–æ–ª–Ω–µ–Ω–∏—è (—á–∏—Å–ª–æ):"), 10);
  if (!amount || amount <= 0) return alert("–ù–µ–≤–µ—Ä–Ω–∞—è —Å—É–º–º–∞!");
  player.coins += amount;

  if (player.firstTopup) {
    player.firstTopup = false;
    // –î–∞—Ä–∏–º –ª–µ–≥–µ–Ω–¥–∞—Ä–Ω—ã–π –º–µ—á –Ω–∞ –ø–µ—Ä–≤—ã–π –¥–æ–Ω–∞—Ç
    const bonusItem = {
      name: "–ú–µ—á –Ω–æ–≤–∏—á–∫–∞+1",
      type: "weapon",
      img: "https://opengameart.org/sites/default/files/Gold_Sword_Icon.png",
      rarity: "legendary",
      bonus: { strength: 5, crit: 5 }
    };
    player.inventory.push(bonusItem);
    log("üéâ –ü–µ—Ä–≤–æ–µ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏–µ! –ü–æ–ª—É—á–µ–Ω –±–æ–Ω—É—Å: " + bonusItem.name);
  }

  const vipGain = Math.floor(amount / 100);
  player.vipLevel += vipGain;
  player.exp += vipGain * 10; // VIP –±–æ–Ω—É—Å –∫ –æ–ø—ã—Ç—É
  log(`üíé –î–æ–Ω–∞—Ç: ${amount} –º–æ–Ω–µ—Ç, VIP +${vipGain}, EXP +${vipGain * 10}`);

  updateInventory();
  updateStatus();
}

// –î–æ–±–∞–≤–ª—è–µ–º –º–æ–±–æ–≤ –Ω–∞ –∫–∞—Ä—Ç—É
const monsters = [
  {
    id: 1,
    name: "–ì–æ–±–ª–∏–Ω",
    x: 100,
    y: 140,
    hp: 30,
    maxHp: 30,
    img: "https://opengameart.org/sites/default/files/goblin_0.png"
  },
  {
    id: 2,
    name: "–°–∫–µ–ª–µ—Ç",
    x: 250,
    y: 100,
    hp: 25,
    maxHp: 25,
    img: "https://opengameart.org/sites/default/files/skeleton_0.png"
  }
];
const monsterDivs = {};

// –†–µ–Ω–¥–µ—Ä –º–æ–±–æ–≤
function renderMonsters() {
  monsters.forEach(monster => {
    if (!monsterDivs[monster.id]) {
      const mDiv = document.createElement("div");
      mDiv.className = "monster";
      const img = document.createElement("img");
      img.src = monster.img;
      mDiv.appendChild(img);
      mapDiv.appendChild(mDiv);
      monsterDivs[monster.id] = mDiv;

      // –ö–ª–∏–∫ –ø–æ –º–æ–±—É ‚Äî –ø—Ä–∏–º–µ—Ä –ª—É—Ç–∞
      mDiv.onclick = () => {
        // –£–±–∏–π—Å—Ç–≤–æ –º–æ–±–∞ (—É–ø—Ä–æ—â–µ–Ω–æ)
        log(`‚öî –£–±–∏–ª–∏ –º–æ–±–∞: ${monster.name}`);
        const loot = generateLoot();
        player.inventory.push(loot);
        log(`üéÅ –í—ã–ø–∞–ª –ª—É—Ç: ${loot.name} (${loot.rarity})`);
        updateInventory();
      };
    }
    const mDiv = monsterDivs[monster.id];
    mDiv.style.left = monster.x + "px";
    mDiv.style.top = monster.y + "px";
  });
}

// –õ—É—Ç —Å —Ä–µ–¥–∫–æ—Å—Ç—å—é (–∫–∞—Ä—Ç–∏–Ω–∫–∏ —Å opengameart, kenney)
function generateLoot() {
  const rarityTable = [
    {
      name: "–ú–µ—á –Ω–æ–≤–∏—á–∫–∞",
      type: "weapon",
      img: "https://opengameart.org/sites/default/files/Sword_Icon.png",
      rarity: "common",
      bonus: { strength: 1 }
    },
    {
      name: "–î–æ—Å–ø–µ—Ö —Ä–µ–¥–∫–∏–π",
      type: "armor",
      img: "https://opengameart.org/sites/default/files/Armor_Icon.png",
      rarity: "rare",
      bonus: { hp: 20 }
    },
    {
      name: "–©–∏—Ç —ç–ø–∏—á–µ—Å–∫–∏–π",
      type: "shield",
      img: "https://opengameart.org/sites/default/files/shield_0.png",
      rarity: "epic",
      bonus: { crit: 5 }
    },
    {
      name: "–ú–µ—á –ª–µ–≥–µ–Ω–¥–∞—Ä–Ω—ã–π",
      type: "weapon",
      img: "https://opengameart.org/sites/default/files/Golden_Sword_Icon.png",
      rarity: "legendary",
      bonus: { strength: 5, crit: 10 }
    }
  ];
  const roll = Math.random();
  let item;
  if (roll < 0.5) item = rarityTable[0];
  else if (roll < 0.75) item = rarityTable[1];
  else if (roll < 0.9) item = rarityTable[2];
  else item = rarityTable[3];
  return item;
}

// –ù–∞–≤—ã–∫–∏
function openSkillTree() {
  const modal = document.getElementById("skillTreeModal");
  modal.classList.add("visible");
  updateSkillTree();
}
function closeSkillTree() {
  const modal = document.getElementById("skillTreeModal");
  modal.classList.remove("visible");
}

function updateSkillTree() {
  const skillsDiv = document.getElementById("skillsList");
  skillsDiv.innerHTML = "";
  document.getElementById("skillPoints").innerText = player.skillPoints;
  for (let key in player.skills) {
    let div = document.createElement("div");
    div.innerHTML = `${key.toUpperCase()}: ${player.skills[key]} <button onclick="upgradeSkill('${key}')">+</button>`;
    skillsDiv.appendChild(div);
  }
}
function upgradeSkill(skill) {
  if (player.skillPoints <= 0) return;
  player.skills[skill] += 1;
  player.skillPoints -= 1;
  log(`üÜô ${skill.toUpperCase()} +1`);
  updateSkillTree();
}

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
updateCharacterView();
updateInventory();
updateStatus();
renderMonsters();
</script>
</body>
</html>