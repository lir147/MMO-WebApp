<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Mobile RPG</title>
<style>
body{font-family:sans-serif; margin:0; padding:0; background:#111; color:#eee;}
#tabs{display:flex; justify-content:space-around; background:#222;}
#tabs button{flex:1; padding:10px; background:#222; color:#eee; border:none;}
#tabs button.active{background:#444;}
.tabContent{display:none; padding:10px;}
.tabContent.active{display:block;}
#characterImage{position:relative;width:150px;height:150px;margin:10px auto;}
#inventory img{width:50px;height:50px;margin:2px;}
#battleLog, #chatLog{height:150px; overflow:auto; border:1px solid #555; padding:5px; background:#000; color:#0f0;}
button{margin:2px; padding:5px;}
#monsterHPContainer{width:100%; background:#333; height:20px; margin:5px 0; display:none;}
#monsterHP{height:100%; background:red; width:0;}
</style>
</head>
<body>

<div id="tabs">
  <button class="tabBtn active" onclick="switchTab('characterTab')">Персонаж</button>
  <button class="tabBtn" onclick="switchTab('inventoryTab')">Инвентарь</button>
  <button class="tabBtn" onclick="switchTab('locationTab')">Локации</button>
  <button class="tabBtn" onclick="switchTab('battleTab')">Бой</button>
  <button class="tabBtn" onclick="switchTab('chatTab')">Чат</button>
</div>

<!-- ------------------ Вкладки ------------------ -->

<div id="characterTab" class="tabContent active">
  <div id="createCharacter">
    <h2>Создать персонажа</h2>
    <select id="classSelect">
      <option value="warrior">Воин</option>
      <option value="mage">Маг</option>
      <option value="archer">Лучник</option>
      <option value="assassin">Ассасин</option>
    </select>
    <button onclick="createCharacter()">Создать</button>
  </div>
  <div id="mainGameCharacter" class="hidden">
    <div id="characterImage"></div>
    <div id="stats"></div>
  </div>
</div>

<div id="inventoryTab" class="tabContent">
  <h3>Инвентарь</h3>
  <div id="inventory"></div>
</div>

<div id="locationTab" class="tabContent">
  <button onclick="moveLevel(-1)">⬅ Назад по уровню</button>
  <button onclick="moveLevel(1)">Вперед по уровню ➡</button>
  <div id="locationInfo"></div>
</div>

<div id="battleTab" class="tabContent">
  <button onclick="fightMonster()">Сражение с монстром</button>
  <div id="monsterHPContainer"><div id="monsterHP"></div></div>
  <div id="battleLog"></div>
</div>

<div id="chatTab" class="tabContent">
  <div id="chatLog"></div>
  <input type="text" id="chatInput" placeholder="Сообщение...">
  <button onclick="sendMessage()">Отправить</button>
</div>

<script>
// ----- Игрок -----
let player = null;
let currentDungeonIndex=0;
let currentLevelIndex=0;
let monsterHPValue=0;
let monsterMaxHP=0;

const classes = {
  warrior:{hp:100, attack:10, crit:5, speed:5, mana:0, skills:['Удар','Сильный удар']},
  mage:{hp:70, attack:5, crit:5, speed:5, mana:50, skills:['Огненный шар','Ледяной снаряд']},
  archer:{hp:80, attack:8, crit:10, speed:7, mana:0, skills:['Стрела','Прицельный выстрел']},
  assassin:{hp:75, attack:12, crit:15, speed:10, mana:0, skills:['Удар в спину','Яд']},
};

const equipment = {
  warrior:{weapon:['Меч','Топор'], armor:['Щит','Броня']},
  mage:{weapon:['Посох','Книга'], armor:['Мантия','Роба']},
  archer:{weapon:['Лук','Арбалет'], armor:['Кожаная броня','Плащ']},
  assassin:{weapon:['Кинжал','Короткий меч'], armor:['Легкая броня','Маска']}
};

// ----- Подземелья -----
const dungeons=[
  {name:'Лесная тропа', levels:[
    {level:1, monsters:['Гоблин','Крысолов']},
    {level:2, monsters:['Гоблин','Волк']},
    {level:3, monsters:['Гоблин','Орк']},
    {level:4, monsters:['Волк','Орк']},
    {level:5, monsters:['Орк','Тролль']}
  ]},
  {name:'Подземелье', levels:[
    {level:1, monsters:['Паук','Скелет']},
    {level:2, monsters:['Паук','Зомби']},
    {level:3, monsters:['Скелет','Зомби']},
    {level:4, monsters:['Скелет','Призрак']},
    {level:5, monsters:['Призрак','Тёмный рыцарь']}
  ]}
];

// ----- Сохранение -----
function savePlayer(){ localStorage.setItem('rpgPlayer',JSON.stringify(player)); }
function loadPlayer(){
  const p = localStorage.getItem('rpgPlayer');
  if(p){ player=JSON.parse(p); showMainGame(); updateStatsUI(); updateInventoryUI(); updateCharacterDisplay(); updateLocationUI(); }
}
loadPlayer();

// ----- Создание -----
function createCharacter(){
  const cls = document.getElementById('classSelect').value;
  const stats = classes[cls];
  player = {
    class:cls, level:1, exp:0, hp:stats.hp, attack:stats.attack, crit:stats.crit, speed:stats.speed, mana:stats.mana,
    skills:stats.skills,
    inventory:[], weapon:null, armor:null, gold:0
  };
  savePlayer();
  showMainGame();
  updateStatsUI();
  updateCharacterDisplay();
}

// ----- UI -----
function switchTab(tabId){
  document.querySelectorAll('.tabContent').forEach(t=>t.classList.remove('active'));
  document.getElementById(tabId).classList.add('active');
  document.querySelectorAll('.tabBtn').forEach(b=>b.classList.remove('active'));
  event.currentTarget.classList.add('active');
}

function showMainGame(){
  document.getElementById('createCharacter').classList.add('hidden');
  document.getElementById('mainGameCharacter').classList.remove('hidden');
}

function updateStatsUI(){
  const statsDiv=document.getElementById('stats');
  statsDiv.innerHTML=`Класс: ${player.class}<br>HP: ${player.hp}<br>Атака: ${player.attack} | Крит: ${player.crit} | Скорость: ${player.speed} | Мана: ${player.mana}<br>Золото: ${player.gold}`;
}

function updateInventoryUI(){
  const inv=document.getElementById('inventory'); inv.innerHTML='';
  player.inventory.forEach(item=>{
    const img=document.createElement('img'); img.src=`icons/${item.name}.png`; img.title=`${item.name}`; inv.appendChild(img);
  });
}

function updateCharacterDisplay(){
  const div=document.getElementById('characterImage'); div.innerHTML='';
  const charDiv=document.createElement('div');
  charDiv.style.width='100%'; charDiv.style.height='100%';
  charDiv.style.background=`url('icons/${player.class}.png') center/contain no-repeat`;
  div.appendChild(charDiv);
  if(player.weapon){ const wDiv=document.createElement('div'); wDiv.style.cssText='width:100%;height:100%;position:absolute;'; wDiv.style.background=`url('icons/${player.weapon}.png') center/contain no-repeat`; div.appendChild(wDiv);}
  if(player.armor){ const aDiv=document.createElement('div'); aDiv.style.cssText='width:100%;height:100%;position:absolute;'; aDiv.style.background=`url('icons/${player.armor}.png') center/contain no-repeat`; div.appendChild(aDiv);}
}

// ----- Локации -----
function moveLevel(step){
  currentLevelIndex+=step; if(currentLevelIndex<0) currentLevelIndex=0; if(currentLevelIndex>4) currentLevelIndex=4; updateLocationUI();
}
function updateLocationUI(){
  const dungeon=dungeons[currentDungeonIndex]; const level=dungeon.levels[currentLevelIndex];
  document.getElementById('locationInfo').innerHTML=`<b>Локация:</b> ${dungeon.name}<br><b>Уровень:</b> ${level.level}<br><b>Монстры:</b> ${level.monsters.join(', ')}`;
}

// ----- Бой -----
function fightMonster(){
  const dungeon=dungeons[currentDungeonIndex]; const level=dungeon.levels[currentLevelIndex];
  const monster=level.monsters[randomInt(0,level.monsters.length-1)];
  const monsterLvl=level.level;
  monsterMaxHP=20*monsterLvl; monsterHPValue=monsterMaxHP;
  document.getElementById('monsterHPContainer').style.display='block';
  document.getElementById('monsterHP').style.width='100%';
  addBattleLog(`Встречен ${monster} уровня ${monsterLvl} с ${monsterHPValue} HP`);

  const battleInterval=setInterval(()=>{
    const skill=player.skills[randomInt(0,player.skills.length-1)];
    const damage=player.attack+randomInt(0,5); monsterHPValue-=damage; if(monsterHPValue<0) monsterHPValue=0;
    document.getElementById('monsterHP').style.width=(monsterHPValue/monsterMaxHP*100)+'%';
    addBattleLog(`Вы используете ${skill} и наносите ${damage} урона`);
    const monsterAttack=5*monsterLvl; player.hp-=monsterAttack; if(player.hp<0) player.hp=0; updateStatsUI(); addBattleLog(`Монстр атакует! Урон: ${monsterAttack}. HP: ${player.hp}`);
    if(player.hp<=0){ alert('Вы погибли!'); localStorage.removeItem('rpgPlayer'); location.reload(); clearInterval(battleInterval); return; }
    if(monsterHPValue<=0){ addBattleLog(`${monster} побежден! Вы получаете ${monsterLvl*2} опыта`); player.exp+=monsterLvl*2; savePlayer(); updateStatsUI(); clearInterval(battleInterval);}
  },1000);
}
function addBattleLog(msg){ const log=document.getElementById('battleLog'); log.innerHTML+=msg+'<br>'; log.scrollTop=log.scrollHeight; }
function randomInt(min,max){ return Math.floor(Math.random()*(max-min+1))+min; }

// ----- Чат -----
function sendMessage(){
  const msg=document.getElementById('chatInput').value; if(!msg) return;
  const log=document.getElementById('chatLog'); log.innerHTML+=`<b>Вы:</b> ${msg}<br>`; log.scrollTop=log.scrollHeight;
  document.getElementById('chatInput').value='';
}
</script>
</body>
</html>
