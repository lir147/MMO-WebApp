<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>RPG Telegram WebApp</title>
<style>
:root{--dark-bg:#0f172a;--panel-bg:#1e293b;--accent:#3b82f6;--accent-dark:#2563eb;--text:#f1f5f9;--text-muted:#94a3b8;--health:#ef4444;--mana:#6366f1;--xp:#10b981;--strength:#f59e0b;--agility:#10b981;--vitality:#ef4444;--intellect:#3b82f6;--locked:#475569;--gold:#f59e0b;--success:#10b981;--danger:#ef4444;}
body{background:var(--dark-bg);color:var(--text);font-family:sans-serif;margin:0;padding:0;}
.container{max-width:500px;margin:auto;padding:10px;}
header{display:flex;justify-content:space-between;align-items:center;margin-bottom:10px;}
.character-info{display:flex;align-items:center;}
.character-visual{width:80px;height:80px;background:var(--panel-bg);border-radius:10px;position:relative;margin-right:10px;}
.header-text h1{margin:0;font-size:18px;}
.gold-display{font-size:18px;}
.tabs{display:flex;justify-content:space-around;margin-bottom:10px;}
.tab-btn{background:var(--panel-bg);border:none;color:var(--text);padding:5px 10px;border-radius:5px;cursor:pointer;}
.tab-btn.active{background:var(--accent);}
.tab-content{display:none;}
.tab-content.active{display:block;}
.inventory-grid,.skills-grid{display:flex;flex-wrap:wrap;gap:5px;}
.item-slot{background:var(--panel-bg);padding:5px;border-radius:5px;cursor:pointer;}
.start-button{background:var(--accent);border:none;color:#fff;padding:5px 10px;border-radius:5px;cursor:pointer;}
</style>
</head>
<body>
<div class="container">
<header>
<div class="character-info">
<div class="character-visual">
<div class="character-base" id="character-base"></div>
<div class="character-weapon" id="character-weapon"></div>
<div class="character-armor" id="character-armor"></div>
</div>
<div class="header-text">
<h1 id="header-name">–í–æ–∏–Ω</h1>
<div id="header-level">–£—Ä–æ–≤–µ–Ω—å 1</div>
</div>
</div>
<div class="gold-display"><span>ü™ô</span><span id="gold-amount">50</span></div>
</header>

<div class="tabs">
<button class="tab-btn active" data-tab="stats">–•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏</button>
<button class="tab-btn" data-tab="skills">–£–º–µ–Ω–∏—è</button>
<button class="tab-btn" data-tab="inventory">–ò–Ω–≤–µ–Ω—Ç–∞—Ä—å</button>
<button class="tab-btn" data-tab="combat">–ë–æ–π</button>
<button class="tab-btn" data-tab="tavern">–¢–∞–≤–µ—Ä–Ω–∞</button>
</div>

<div class="tab-content active" id="stats">
<h2>–•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏</h2>
<div id="stats-container"></div>
</div>

<div class="tab-content" id="skills">
<h2>–£–º–µ–Ω–∏—è</h2>
<div id="skills-grid"></div>
</div>

<div class="tab-content" id="inventory">
<h2>–ò–Ω–≤–µ–Ω—Ç–∞—Ä—å</h2>
<div class="inventory-grid" id="inventory-grid"></div>
</div>

<div class="tab-content" id="combat">
<h2>–ë–æ–π</h2>
<div id="enemy-info"></div>
<button class="start-button" id="attack-btn">–ê—Ç–∞–∫–æ–≤–∞—Ç—å</button>
<div id="combat-log" style="margin-top:10px; color:#fff;"></div>
</div>

<div class="tab-content" id="tavern">
<h2>–¢–∞–≤–µ—Ä–Ω–∞</h2>
<button class="start-button" id="visit-tavern-btn">–ü–æ—Å–µ—Ç–∏—Ç—å —Ç–∞–≤–µ—Ä–Ω—É</button>
<div id="tavern-log" style="margin-top:10px; color:#fff;"></div>
</div>
</div>

<script>
// --- Character ---
let character = {
    name: "–í–æ–∏–Ω",
    class: "warrior",
    level: 1,
    health: 100,
    maxHealth: 100,
    mana: 50,
    maxMana: 50,
    xp: 0,
    xpToNext: 100,
    gold: 50,
    strength: 10,
    agility: 10,
    vitality: 10,
    intellect: 10,
    inventory: [],
    equipment: {weapon:null, armor:null},
    skills: [
        {name:"–£–¥–∞—Ä", level:1, maxLevel:5},
        {name:"–ó–∞—â–∏—Ç–∞", level:1, maxLevel:5}
    ]
};

// --- Items ---
const items = [
    {id:1,name:"–ú–µ—á",type:"weapon",attack:5,value:20},
    {id:2,name:"–õ—É–∫",type:"weapon",attack:3,value:15},
    {id:3,name:"–ë—Ä–æ–Ω—è",type:"armor",defense:5,value:25},
    {id:4,name:"–ú–∞–Ω–∞ –ü–æ—Ç",type:"consumable",mana:20,value:10},
    {id:5,name:"–ó–µ–ª—å–µ –∑–¥–æ—Ä–æ–≤—å—è",type:"consumable",health:30,value:15}
];

// --- Enemy types ---
const enemies = [
    {name:"–ì–æ–±–ª–∏–Ω",health:30,attack:5,xp:20,gold:10},
    {name:"–°–∫–µ–ª–µ—Ç",health:40,attack:7,xp:30,gold:15},
    {name:"–û–≥—Ä",health:60,attack:12,xp:50,gold:25},
    {name:"–î—Ä–∞–∫–æ–Ω—á–∏–∫",health:100,attack:20,xp:100,gold:50}
];

let enemy = spawnEnemy();

// --- Tabs ---
document.querySelectorAll('.tab-btn').forEach(btn=>{
    btn.addEventListener('click',()=>{
        document.querySelectorAll('.tab-btn').forEach(b=>b.classList.remove('active'));
        btn.classList.add('active');
        document.querySelectorAll('.tab-content').forEach(tc=>tc.classList.remove('active'));
        document.getElementById(btn.dataset.tab).classList.add('active');
        renderAll();
    });
});

// --- Render functions ---
function renderStats(){
    document.getElementById('stats-container').innerHTML = `
        <p>–£—Ä–æ–≤–µ–Ω—å: ${character.level}</p>
        <p>–ó–¥–æ—Ä–æ–≤—å–µ: ${character.health}/${character.maxHealth}</p>
        <p>–ú–∞–Ω–∞: ${character.mana}/${character.maxMana}</p>
        <p>–°–∏–ª–∞: ${character.strength}</p>
        <p>–õ–æ–≤–∫–æ—Å—Ç—å: ${character.agility}</p>
        <p>–í—ã–Ω–æ—Å–ª–∏–≤–æ—Å—Ç—å: ${character.vitality}</p>
        <p>–ò–Ω—Ç–µ–ª–ª–µ–∫—Ç: ${character.intellect}</p>
        <p>–ó–æ–ª–æ—Ç–æ: ${character.gold}</p>
    `;
}

function renderSkills(){
    const container = document.getElementById('skills-grid');
    container.innerHTML="";
    character.skills.forEach((s,i)=>{
        const div = document.createElement('div');
        div.textContent = `${s.name} (–£—Ä–æ–≤–µ–Ω—å ${s.level}) `;
        const btn = document.createElement('button');
        btn.textContent="–£–ª—É—á—à–∏—Ç—å";
        btn.disabled = s.level >= s.maxLevel;
        btn.addEventListener('click',()=>{
            if(s.level<s.maxLevel){s.level++; renderSkills();}
        });
        div.appendChild(btn);
        container.appendChild(div);
    });
}

function renderInventory(){
    const container = document.getElementById('inventory-grid');
    container.innerHTML="";
    character.inventory.forEach(item=>{
        const slot = document.createElement('div');
        slot.className="item-slot";
        slot.textContent = item.name;
        slot.addEventListener('click',()=>useItem(item));
        container.appendChild(slot);
    });
}

function useItem(item){
    if(item.type==="consumable"){
        if(item.mana) character.mana = Math.min(character.mana+item.mana,character.maxMana);
        if(item.health) character.health = Math.min(character.health+item.health,character.maxHealth);
        alert(`${item.name} –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω`);
        character.inventory = character.inventory.filter(i=>i.id!==item.id);
        renderInventory();
    }else if(item.type==="weapon" || item.type==="armor"){
        character.equipment[item.type] = item;
        alert(`${item.name} —ç–∫–∏–ø–∏—Ä–æ–≤–∞–Ω`);
        renderAll();
    }
}

// --- Combat ---
function renderEnemy(){
    document.getElementById('enemy-info').textContent = `${enemy.name} HP: ${enemy.health}`;
}
document.getElementById('attack-btn').addEventListener('click',()=>{
    const dmg = character.strength + (character.equipment.weapon?.attack||0);
    enemy.health -= dmg;
    const log = document.getElementById('combat-log');
    log.innerHTML += `<p>–í—ã –Ω–∞–Ω–µ—Å–ª–∏ ${dmg} —É—Ä–æ–Ω–∞!</p>`;
    if(enemy.health>0){
        character.health -= enemy.attack;
        log.innerHTML += `<p>${enemy.name} –Ω–∞–Ω–µ—Å ${enemy.attack} —É—Ä–æ–Ω–∞!</p>`;
    }else{
        log.innerHTML += `<p>${enemy.name} –ø–æ–≤–µ—Ä–∂–µ–Ω! –í—ã –ø–æ–ª—É—á–∞–µ—Ç–µ ${enemy.xp} XP –∏ ${enemy.gold} –∑–æ–ª–æ—Ç–∞.</p>`;
        character.xp += enemy.xp;
        character.gold += enemy.gold;
        dropLoot();
        enemy = spawnEnemy();
        levelUpCheck();
    }
    renderStats();
    renderEnemy();
});

function spawnEnemy(){
    return JSON.parse(JSON.stringify(enemies[Math.floor(Math.random()*enemies.length)]));
}

// --- Loot drops ---
function dropLoot(){
    if(Math.random()<0.5){
        const loot = items[Math.floor(Math.random()*items.length)];
        character.inventory.push(loot);
        const log = document.getElementById('combat-log');
        log.innerHTML += `<p>–í—ã –Ω–∞—à–ª–∏ –ø—Ä–µ–¥–º–µ—Ç: ${loot.name}!</p>`;
        renderInventory();
    }
}

// --- Tavern events ---
document.getElementById('visit-tavern-btn').addEventListener('click',()=>{
    const log = document.getElementById('tavern-log');
    const event = Math.random();
    if(event<0.4){
        const goldFound = Math.floor(Math.random()*20)+5;
        character.gold += goldFound;
        log.innerHTML += `<p>–í—ã –Ω–∞—à–ª–∏ –≤ —Ç–∞–≤–µ—Ä–Ω–µ ${goldFound} –∑–æ–ª–æ—Ç–∞!</p>`;
    } else if(event<0.7){
        const item = items[Math.floor(Math.random()*items.length)];
        character.inventory.push(item);
        log.innerHTML += `<p>–í—ã –∫—É–ø–∏–ª–∏ –ø—Ä–µ–¥–º–µ—Ç: ${item.name}!</p>`;
        renderInventory();
    } else{
        const goldLost = Math.min(character.gold,Math.floor(Math.random()*15)+5);
        character.gold -= goldLost;
        log.innerHTML += `<p>–í—ã –ø—Ä–æ–∏–≥—Ä–∞–ª–∏ ${goldLost} –∑–æ–ª–æ—Ç–∞ –≤ —Ç–∞–≤–µ—Ä–Ω–µ!</p>`;
    }
    renderStats();
});

// --- Level up ---
function levelUpCheck(){
    while(character.xp>=character.xpToNext){
        character.level++;
        character.xp -= character.xpToNext;
        character.xpToNext = Math.floor(character.xpToNext*1.5);
        character.maxHealth+=10;
        character.health = character.maxHealth;
        character.maxMana+=5;
        character.mana = character.maxMana;
        alert("üéâ –í—ã –ø–æ–≤—ã—Å–∏–ª–∏ —É—Ä–æ–≤–µ–Ω—å!");
    }
}

// --- Render all ---
function renderAll(){
    renderStats();
    renderSkills();
    renderInventory();
    renderEnemy();
}

// --- Initialize inventory ---
character.inventory.push(items[0],items[2],items[3]);
renderAll();
</script>
</body>
</html>
