<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RPG Персонаж</title>
    <style>
        :root {
            --dark-bg: #0f172a;
            --panel-bg: #1e293b;
            --accent: #3b82f6;
            --accent-dark: #2563eb;
            --text: #f1f5f9;
            --text-muted: #94a3b8;
            --health: #ef4444;
            --mana: #6366f1;
            --xp: #10b981;
            --strength: #f59e0b;
            --agility: #10b981;
            --vitality: #ef4444;
            --intellect: #3b82f6;
            --locked: #475569;
            --gold: #f59e0b;
            --success: #10b981;
            --danger: #ef4444;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: var(--dark-bg);
            color: var(--text);
            min-height: 100vh;
            padding: 20px;
            background-image:
                radial-gradient(circle at 15% 50%, rgba(30, 41, 59, 0.4) 0%, transparent 25%),
                radial-gradient(circle at 85% 30%, rgba(30, 41, 59, 0.4) 0%, transparent 25%);
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            margin-bottom: 20px;
            padding: 20px;
            background: var(--panel-bg);
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.4);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .character-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .character-visual {
            position: relative;
            width: 80px;
            height: 80px;
            background: rgba(30, 41, 59, 0.7);
            border-radius: 8px;
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .character-base {
            width: 50px;
            height: 50px;
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><circle cx="50" cy="50" r="40" fill="%23f59e0b"/></svg>');
            background-size: contain;
            background-repeat: no-repeat;
        }

        .character-weapon {
            position: absolute;
            width: 30px;
            height: 30px;
            background-size: contain;
            background-repeat: no-repeat;
            top: 25px;
            left: 45px;
        }

        .character-armor {
            position: absolute;
            width: 40px;
            height: 40px;
            background-size: contain;
            background-repeat: no-repeat;
            top: 20px;
            left: 30px;
        }

        .header-text h1 {
            font-size: 1.5rem;
            margin-bottom: 5px;
            color: var(--accent);
        }

        .header-text div {
            color: var(--text-muted);
        }

        .gold-display {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 1.2rem;
            font-weight: bold;
            color: var(--gold);
            background: rgba(245, 158, 11, 0.1);
            padding: 10px 15px;
            border-radius: 8px;
        }

        h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            color: var(--accent);
            text-shadow: 0 0 10px rgba(59, 130, 246, 0.5);
        }

        /* Tabs */
        .tabs {
            display: flex;
            margin-bottom: 20px;
            background: var(--panel-bg);
            border-radius: 12px;
            overflow: hidden;
        }

        .tab-btn {
            flex: 1;
            padding: 15px;
            background: transparent;
            border: none;
            color: var(--text-muted);
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: bold;
        }

        .tab-btn:hover {
            background: rgba(59, 130, 246, 0.1);
            color: var(--text);
        }

        .tab-btn.active {
            background: var(--accent);
            color: white;
        }

        .tab-content {
            display: none;
            animation: fadeIn 0.3s ease;
        }

        .tab-content.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Character Creation */
        .character-creation {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }

        .creation-panel {
            background: var(--panel-bg);
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.4);
        }

        .creation-panel h2 {
            margin-bottom: 20px;
            color: var(--accent);
            border-bottom: 2px solid var(--accent);
            padding-bottom: 10px;
        }

        .nickname-input {
            margin-bottom: 20px;
        }

        .nickname-input label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
        }

        .nickname-input input {
            width: 100%;
            padding: 12px;
            background: rgba(30, 41, 59, 0.7);
            border: 2px solid #334155;
            border-radius: 8px;
            color: var(--text);
            font-size: 1rem;
        }

        .nickname-input input:focus {
            outline: none;
            border-color: var(--accent);
        }

        .class-grid, .gender-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }

        .class-option, .gender-option {
            background: rgba(30, 41, 59, 0.7);
            border: 2px solid #334155;
            border-radius: 8px;
            padding: 15px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .class-option:hover, .gender-option:hover {
            transform: translateY(-3px);
            border-color: var(--accent);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }

        .class-option.selected, .gender-option.selected {
            border-color: var(--accent);
            background: rgba(59, 130, 246, 0.2);
            box-shadow: 0 0 15px rgba(59, 130, 246, 0.5);
        }

        .class-icon {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }

        .class-name {
            font-weight: bold;
            margin-bottom: 5px;
        }

        .class-desc {
            font-size: 0.85rem;
            color: var(--text-muted);
        }

        .character-preview {
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid #334155;
        }

        .character-preview h3 {
            margin-bottom: 15px;
            color: var(--accent);
        }

        .preview-content {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        #character-avatar {
            font-size: 3rem;
        }

        #character-info {
            flex: 1;
        }

        #character-name {
            font-size: 1.2rem;
            font-weight: bold;
            margin-bottom: 5px;
        }

        #character-level {
            color: var(--text-muted);
        }

        /* Stats Panel */
        .character-sheet {
            display: grid;
            grid-template-columns: 300px 1fr;
            gap: 20px;
        }

        .stats-panel {
            background: var(--panel-bg);
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.4);
        }

        .character-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 20px;
            padding-bottom: 20px;
            border-bottom: 1px solid #334155;
        }

        #stats-avatar {
            font-size: 3rem;
            position: relative;
        }

        .equipment-slots {
            position: absolute;
            font-size: 0.8rem;
            background: rgba(0, 0, 0, 0.7);
            border-radius: 4px;
            padding: 2px 5px;
        }

        #weapon-slot {
            top: 0;
            right: -5px;
        }

        #armor-slot {
            bottom: 0;
            right: -5px;
        }

        #stats-name {
            font-size: 1.2rem;
            font-weight: bold;
        }

        #stats-class {
            color: var(--text-muted);
        }

        .resource-bar {
            margin-bottom: 20px;
        }

        .bar-label {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
        }

        .bar {
            height: 20px;
            background: #334155;
            border-radius: 10px;
            overflow: hidden;
        }

        .bar-fill {
            height: 100%;
            border-radius: 10px;
            transition: width 0.3s ease;
        }

        .health .bar-fill {
            background: var(--health);
        }

        .mana .bar-fill {
            background: var(--mana);
        }

        .xp .bar-fill {
            background: var(--xp);
        }

        .attributes {
            margin-top: 25px;
        }

        .attribute {
            display: flex;
            justify-content: space-between;
            margin-bottom: 12px;
            padding-bottom: 12px;
            border-bottom: 1px solid #334155;
        }

        .attribute-name {
            display: flex;
            align-items: center;
            font-weight: bold;
        }

        .attribute-icon {
            margin-right: 10px;
            width: 24px;
            text-align: center;
        }

        .upgrade-btn {
            background: var(--accent);
            color: white;
            border: none;
            border-radius: 4px;
            padding: 4px 8px;
            cursor: pointer;
            font-size: 0.8rem;
            transition: all 0.2s;
        }

        .upgrade-btn:hover {
            background: var(--accent-dark);
        }

        .upgrade-btn:disabled {
            background: var(--locked);
            cursor: not-allowed;
        }

        .combat-stats {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-top: 25px;
        }

        .stat-item {
            background: rgba(30, 41, 59, 0.7);
            padding: 12px;
            border-radius: 8px;
            text-align: center;
        }

        .stat-value {
            font-size: 1.2rem;
            font-weight: bold;
            color: var(--accent);
        }

        .stat-name {
            font-size: 0.85rem;
            color: var(--text-muted);
        }

        /* Inventory */
        .inventory-panel {
            background: var(--panel-bg);
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.4);
        }

        .inventory-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .inventory-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 10px;
            margin-top: 15px;
        }

        .item-slot {
            background: rgba(30, 41, 59, 0.7);
            height: 70px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 2px solid #334155;
            transition: all 0.3s ease;
            position: relative;
            cursor: pointer;
        }

        .item-slot.equipped {
            border-color: var(--accent);
            box-shadow: 0 0 10px rgba(59, 130, 246, 0.5);
        }

        .item-slot.empty::before {
            content: "+";
            font-size: 1.5rem;
            color: var(--text-muted);
        }

        .item-slot:hover {
            border-color: var(--accent);
        }

        .item-icon {
            font-size: 2rem;
        }

        .item-count {
            position: absolute;
            bottom: 5px;
            right: 5px;
            background: rgba(0, 0, 0, 0.7);
            border-radius: 50%;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
        }

        .item-context-menu {
            position: absolute;
            background: var(--panel-bg);
            border-radius: 8px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.4);
            z-index: 100;
            padding: 10px;
            display: none;
            flex-direction: column;
            gap: 5px;
        }

        .item-context-btn {
            padding: 8px 12px;
            background: var(--accent);
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            text-align: left;
        }

        .item-context-btn.sell {
            background: var(--success);
        }

        .item-context-btn.dismantle {
            background: var(--danger);
        }

        /* Skills */
        .skills-container {
            background: var(--panel-bg);
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.4);
        }

        .skills-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .skill-card {
            background: rgba(30, 41, 59, 0.7);
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            transition: all 0.3s ease;
            cursor: pointer;
            position: relative;
        }

        .skill-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }

        .skill-level {
            position: absolute;
            top: 10px;
            right: 10px;
            background: var(--accent);
            color: white;
            border-radius: 50%;
            width: 25px;
            height: 25px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
            font-weight: bold;
        }

        .skill-icon {
            width: 50px;
            height: 50px;
            margin: 0 auto 10px;
            background-size: contain;
            background-repeat: no-repeat;
            background-position: center;
        }

        .skill-name {
            font-weight: bold;
            margin-bottom: 5px;
        }

        .skill-desc {
            font-size: 0.85rem;
            color: var(--text-muted);
            margin-bottom: 8px;
        }

        .skill-cost {
            font-size: 0.8rem;
            color: var(--mana);
        }

        .skill-upgrade {
            margin-top: 10px;
            background: var(--accent);
            color: white;
            border: none;
            border-radius: 4px;
            padding: 5px 10px;
            cursor: pointer;
            font-size: 0.8rem;
        }

        .skill-upgrade:disabled {
            background: var(--locked);
            cursor: not-allowed;
        }

        /* Tavern */
        .tavern-panel {
            background: var(--panel-bg);
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.4);
        }

        .tavern-tabs {
            display: flex;
            margin-bottom: 20px;
            background: rgba(30, 41, 59, 0.7);
            border-radius: 8px;
            overflow: hidden;
        }

        .tavern-tab {
            flex: 1;
            padding: 12px;
            background: transparent;
            border: none;
            color: var(--text-muted);
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .tavern-tab.active {
            background: var(--accent);
            color: white;
        }

        .tavern-content {
            display: none;
        }

        .tavern-content.active {
            display: block;
        }

        .shop-items, .blacksmith-items {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
        }

        .shop-item, .blacksmith-item {
            background: rgba(30, 41, 59, 0.7);
            padding: 15px;
            border-radius: 8px;
            text-align: center;
        }

        .item-icon {
            font-size: 2rem;
            margin-bottom: 10px;
        }

        .item-name {
            font-weight: bold;
            margin-bottom: 5px;
        }

        .item-desc {
            font-size: 0.85rem;
            color: var(--text-muted);
            margin-bottom: 10px;
        }

        .item-price {
            color: var(--gold);
            font-weight: bold;
            margin-bottom: 10px;
        }

        .buy-btn, .craft-btn, .sell-btn, .upgrade-btn, .dismantle-btn {
            width: 100%;
            padding: 8px;
            background: var(--accent);
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.3s;
            margin-top: 5px;
        }

        .buy-btn:hover, .craft-btn:hover, .sell-btn:hover, .upgrade-btn:hover, .dismantle-btn:hover {
            background: var(--accent-dark);
        }

        .buy-btn:disabled, .craft-btn:disabled, .sell-btn:disabled, .upgrade-btn:disabled, .dismantle-btn:disabled {
            background: var(--locked);
            cursor: not-allowed;
        }

        .sell-btn {
            background: var(--success);
        }

        .upgrade-btn {
            background: var(--gold);
        }

        .dismantle-btn {
            background: var(--danger);
        }

        /* Blacksmith */
        .blacksmith-tabs {
            display: flex;
            margin-bottom: 15px;
            background: rgba(30, 41, 59, 0.5);
            border-radius: 6px;
            overflow: hidden;
        }

        .blacksmith-subcontent {
            display: none;
        }

        .blacksmith-subcontent.active {
            display: block;
        }

        /* Locations */
        .location-panel {
            background: var(--panel-bg);
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.4);
        }

        .location-title {
            color: var(--accent);
            margin-bottom: 15px;
            border-bottom: 2px solid var(--accent);
            padding-bottom: 10px;
        }

        .location-desc {
            color: var(--text-muted);
            margin-bottom: 20px;
            line-height: 1.6;
        }

        .location-map {
            position: relative;
            width: 100%;
            height: 400px;
            background: rgba(30, 41, 59, 0.7);
            border-radius: 8px;
            margin-bottom: 20px;
            overflow: hidden;
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" width="100" height="100"><rect width="100" height="100" fill="%231e293b"/><path d="M10,10 L90,10 L90,90 L10,90 Z" stroke="%23334155" fill="none"/></svg>');
            background-repeat: repeat;
        }

        .map-cell {
            position: absolute;
            width: 60px;
            height: 60px;
            background: rgba(59, 130, 246, 0.2);
            border: 1px solid var(--accent);
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            cursor: pointer;
            transition: all 0.3s;
        }

        .map-cell:hover {
            transform: scale(1.05);
            background: rgba(59, 130, 246, 0.4);
        }

        .map-cell.player {
            background: rgba(16, 185, 129, 0.4);
            z-index: 10;
        }

        .map-cell.monster {
            background: rgba(239, 68, 68, 0.4);
        }

        .map-cell.empty {
            background: rgba(148, 163, 184, 0.2);
        }

        .map-cell.treasure {
            background: rgba(245, 158, 11, 0.4);
        }

        .map-cell.exit {
            background: rgba(139, 92, 246, 0.4);
        }

        .locations-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }

        .location {
            background: rgba(30, 41, 59, 0.7);
            padding: 20px;
            border-radius: 8px;
            transition: all 0.3s ease;
        }

        .location:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }

        .location-name {
            font-weight: bold;
            margin-bottom: 8px;
            color: var(--accent);
        }

        .location-type {
            font-size: 0.85rem;
            color: var(--text-muted);
            margin-bottom: 10px;
            padding: 4px 8px;
            background: rgba(59, 130, 246, 0.2);
            border-radius: 4px;
            display: inline-block;
        }

        .location-level {
            font-size: 0.85rem;
            color: var(--text-muted);
            margin-bottom: 10px;
        }

        .monsters-list {
            margin: 15px 0;
        }

        .monster {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid #334155;
        }

        .monster:last-child {
            border-bottom: none;
        }

        .location-btn {
            width: 100%;
            padding: 10px;
            background: var(--accent);
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .location-btn:hover {
            background: var(--accent-dark);
        }

        /* Combat Screen */
        .combat-screen {
            background: var(--panel-bg);
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.4);
            text-align: center;
        }

        .combat-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .combatant {
            display: flex;
            flex-direction: column;
            align-items: center;
            width: 45%;
        }

        .combat-avatar {
            width: 80px;
            height: 80px;
            background-size: contain;
            background-repeat: no-repeat;
            background-position: center;
            margin-bottom: 10px;
        }

        .combat-health {
            width: 100%;
            background: #334155;
            height: 20px;
            border-radius: 10px;
            overflow: hidden;
        }

        .combat-health-fill {
            height: 100%;
            background: var(--health);
            transition: width 0.3s;
        }

        .combat-skills {
            display: flex;
            gap: 10px;
            margin-top: 10px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .combat-skill {
            width: 40px;
            height: 40px;
            background-size: contain;
            background-repeat: no-repeat;
            cursor: pointer;
            opacity: 0.7;
            transition: all 0.3s;
            border: 2px solid transparent;
            border-radius: 4px;
        }

        .combat-skill:hover {
            opacity: 1;
            transform: scale(1.1);
            border-color: var(--accent);
        }

        .combat-skill:disabled {
            opacity: 0.3;
            cursor: not-allowed;
        }

        .combat-log {
            margin: 20px 0;
            padding: 15px;
            background: rgba(30, 41, 59, 0.7);
            border-radius: 8px;
            max-height: 200px;
            overflow-y: auto;
            text-align: left;
        }

        .log-entry {
            margin-bottom: 8px;
            padding-bottom: 8px;
            border-bottom: 1px solid #334155;
        }

        .log-entry:last-child {
            margin-bottom: 0;
            padding-bottom: 0;
            border-bottom: none;
        }

        .combat-actions {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
        }

        .combat-btn {
            padding: 12px;
            background: var(--accent);
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .combat-btn:hover {
            background: var(--accent-dark);
        }

        .combat-btn.attack {
            background: var(--danger);
        }

        .combat-btn.attack:hover {
            background: #dc2626;
        }

        /* Loot Screen */
        .loot-screen {
            background: var(--panel-bg);
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.4);
            text-align: center;
        }

        .loot-items {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .loot-item {
            background: rgba(30, 41, 59, 0.7);
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
        }

        .loot-item:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }

        .loot-quality-common { border-left: 4px solid #a0a0a0; }
        .loot-quality-uncommon { border-left: 4px solid #00ff00; }
        .loot-quality-rare { border-left: 4px solid #0070ff; }
        .loot-quality-epic { border-left: 4px solid #a335ee; }
        .loot-quality-legendary { border-left: 4px solid #ff8000; }

        /* Buffs */
        .buffs-container {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            flex-wrap: wrap;
        }

        .buff {
            background: rgba(59, 130, 246, 0.2);
            padding: 8px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        /* Start Button */
        .start-button {
            display: block;
            width: 100%;
            padding: 15px;
            background: var(--accent);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 1.2rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 30px;
            box-shadow: 0 4px 15px rgba(59, 130, 246, 0.4);
        }

        .start-button:hover {
            background: var(--accent-dark);
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(59, 130, 246, 0.5);
        }

        /* Level Up Notification */
        .level-up-notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: var(--accent);
            color: white;
            padding: 15px 20px;
            border-radius: 8px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
            z-index: 1000;
            display: flex;
            align-items: center;
            gap: 10px;
            transform: translateX(100%);
            transition: transform 0.5s ease;
        }

        .level-up-notification.show {
            transform: translateX(0);
        }

        /* Responsive */
        @media (max-width: 900px) {
            .character-creation {
                grid-template-columns: 1fr;
            }

            .character-sheet {
                grid-template-columns: 1fr;
            }

            .combat-stats {
                grid-template-columns: repeat(3, 1fr);
            }

            .skills-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .inventory-grid {
                grid-template-columns: repeat(4, 1fr);
            }

            .locations-grid {
                grid-template-columns: 1fr;
            }

            .shop-items, .blacksmith-items {
                grid-template-columns: repeat(2, 1fr);
            }

            .tabs {
                flex-wrap: wrap;
            }

            .tab-btn {
                flex: 1 0 50%;
            }

            .combat-header {
                flex-direction: column;
                gap: 20px;
            }

            .combatant {
                width: 100%;
            }
        }

        @media (max-width: 600px) {
            .combat-stats {
                grid-template-columns: repeat(2, 1fr);
            }

            .skills-grid {
                grid-template-columns: 1fr;
            }

            .inventory-grid {
                grid-template-columns: repeat(3, 1fr);
            }

            .class-grid, .gender-grid {
                grid-template-columns: 1fr;
            }

            .shop-items, .blacksmith-items {
                grid-template-columns: 1fr;
            }

            .tab-btn {
                flex: 1 0 100%;
            }

            header {
                flex-direction: column;
                gap: 15px;
            }

            .combat-actions {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="character-info">
                <div class="character-visual">
                    <div class="character-base" id="character-base"></div>
                    <div class="character-weapon" id="character-weapon"></div>
                    <div class="character-armor" id="character-armor"></div>
                </div>
                <div class="header-text">
                    <h1 id="header-name">Воин</h1>
                    <div id="header-level">Уровень 1</div>
                </div>
            </div>
            <div class="gold-display">
                <span>🪙</span>
                <span id="gold-amount">50</span>
            </div>
        </header>

        <div class="tabs">
            <button class="tab-btn active" data-tab="creation">Создание</button>
            <button class="tab-btn" data-tab="stats">Характеристики</button>
            <button class="tab-btn" data-tab="skills">Умения</button>
            <button class="tab-btn" data-tab="tavern">Таверна</button>
            <button class="tab-btn" data-tab="location">Локации</button>
        </div>

        <div class="tab-content active" id="creation">
            <div class="character-creation">
                <div class="creation-panel">
                    <h2>Выбор класса</h2>
                    <div class="nickname-input">
                        <label for="nickname">Имя персонажа:</label>
                        <input type="text" id="nickname" placeholder="Введите имя">
                    </div>
                    <div class="class-grid">
                        <div class="class-option selected" data-class="warrior">
                            <div class="class-icon">⚔️</div>
                            <div class="class-name">Воин</div>
                            <div class="class-desc">Сильный боец ближнего боя</div>
                        </div>
                        <div class="class-option" data-class="mage">
                            <div class="class-icon">🧙</div>
                            <div class="class-name">Маг</div>
                            <div class="class-desc">Мощные заклинания и контроль</div>
                        </div>
                        <div class="class-option" data-class="archer">
                            <div class="class-icon">🏹</div>
                            <div class="class-name">Лучник</div>
                            <div class="class-desc">Точные выстрелы на расстоянии</div>
                        </div>
                        <div class="class-option" data-class="rogue">
                            <div class="class-icon">🗡️</div>
                            <div class="class-name">Разбойник</div>
                            <div class="class-desc">Скрытность и смертельные атаки</div>
                        </div>
                    </div>
                </div>

                <div class="creation-panel">
                    <h2>Выбор пола</h2>
                    <div class="gender-grid">
                        <div class="gender-option selected" data-gender="male">
                            <div class="class-icon">👨</div>
                            <div class="class-name">Мужской</div>
                        </div>
                        <div class="gender-option" data-gender="female">
                            <div class="class-icon">👩</div>
                            <div class="class-name">Женский</div>
                        </div>
                    </div>

                    <div class="character-preview">
                        <h3>Предпросмотр</h3>
                        <div class="preview-content">
                            <div id="character-avatar">⚔️</div>
                            <div id="character-info">
                                <div id="character-name">Воин</div>
                                <div id="character-level">Уровень 1</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="tab-content" id="stats">
            <div class="character-sheet">
                <div class="stats-panel">
                    <h2>Характеристики</h2>

                    <div class="character-header">
                        <div id="stats-avatar">
                            ⚔️
                            <div class="equipment-slots" id="weapon-slot"></div>
                            <div class="equipment-slots" id="armor-slot"></div>
                        </div>
                        <div>
                            <div id="stats-name">Воин</div>
                            <div id="stats-class">Уровень 1</div>
                        </div>
                    </div>

                    <div class="resource-bar health">
                        <div class="bar-label">
                            <span>Здоровье</span>
                            <span id="health-value">100 / 100</span>
                        </div>
                        <div class="bar">
                            <div class="bar-fill" id="health-bar"></div>
                        </div>
                    </div>

                    <div class="resource-bar mana">
                        <div class="bar-label">
                            <span>Мана</span>
                            <span id="mana-value">50 / 50</span>
                        </div>
                        <div class="bar">
                            <div class="bar-fill" id="mana-bar"></div>
                        </div>
                    </div>

                    <div class="resource-bar xp">
                        <div class="bar-label">
                            <span>Опыт</span>
                            <span id="xp-value">0 / 100</span>
                        </div>
                        <div class="bar">
                            <div class="bar-fill" id="xp-bar"></div>
                        </div>
                    </div>

                    <div class="attributes">
                        <div class="attribute">
                            <div class="attribute-name">
                                <div class="attribute-icon">💪</div>
                                <span>Сила</span>
                            </div>
                            <div class="attribute-value">
                                <span id="strength-value">5</span>
                                <button class="upgrade-btn" data-stat="strength">+</button>
                            </div>
                        </div>
                        <div class="attribute">
                            <div class="attribute-name">
                                <div class="attribute-icon">🏃</div>
                                <span>Ловкость</span>
                            </div>
                            <div class="attribute-value">
                                <span id="agility-value">5</span>
                                <button class="upgrade-btn" data-stat="agility">+</button>
                            </div>
                        </div>
                        <div class="attribute">
                            <div class="attribute-name">
                                <div class="attribute-icon">❤️</div>
                                <span>Живучесть</span>
                            </div>
                            <div class="attribute-value">
                                <span id="vitality-value">5</span>
                                <button class="upgrade-btn" data-stat="vitality">+</button>
                            </div>
                        </div>
                        <div class="attribute">
                            <div class="attribute-name">
                                <div class="attribute-icon">🧠</div>
                                <span>Интеллект</span>
                            </div>
                            <div class="attribute-value">
                                <span id="intellect-value">5</span>
                                <button class="upgrade-btn" data-stat="intellect">+</button>
                            </div>
                        </div>
                    </div>

                    <div class="combat-stats">
                        <div class="stat-item">
                            <div class="stat-value" id="attack-value">5-7</div>
                            <div class="stat-name">Атака</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value" id="crit-value">5%</div>
                            <div class="stat-name">Крит. удар</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value" id="speed-value">100%</div>
                            <div class="stat-name">Скорость</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value" id="defense-value">5</div>
                            <div class="stat-name">Защита</div>
                        </div>
                    </div>

                    <div class="buffs-container" id="buffs-container">
                        <!-- Buffs will be populated here -->
                    </div>
                </div>

                <div class="inventory-panel">
                    <div class="inventory-header">
                        <h2>Рюкзак</h2>
                        <div id="inventory-weight">0/100</div>
                    </div>
                    <div class="inventory-grid" id="inventory">
                        <div class="item-slot empty"></div>
                        <div class="item-slot empty"></div>
                        <div class="item-slot empty"></div>
                        <div class="item-slot empty"></div>
                        <div class="item-slot empty"></div>
                        <div class="item-slot empty"></div>
                        <div class="item-slot empty"></div>
                        <div class="item-slot empty"></div>
                        <div class="item-slot empty"></div>
                        <div class="item-slot empty"></div>
                    </div>
                </div>
            </div>
        </div>

        <div class="tab-content" id="skills">
            <div class="skills-container">
                <h2>Умения класса</h2>
                <div class="skills-grid" id="skills-grid">
                    <!-- Skills will be populated by JavaScript -->
                </div>
            </div>
        </div>

        <div class="tab-content" id="tavern">
            <div class="tavern-panel">
                <h2>Таверна "У Гнома"</h2>

                <div class="tavern-tabs">
                    <button class="tavern-tab active" data-tab="shop">Магазин</button>
                    <button class="tavern-tab" data-tab="blacksmith">Кузня</button>
                </div>

                <div class="tavern-content active" id="shop-content">
                    <div class="shop-items" id="shop-items">
                        <!-- Shop items will be populated by JavaScript -->
                    </div>
                </div>

                <div class="tavern-content" id="blacksmith-content">
                    <div class="blacksmith-tabs">
                        <button class="tavern-tab active" data-subtab="upgrade">Улучшение</button>
                        <button class="tavern-tab" data-subtab="dismantle">Разборка</button>
                    </div>

                    <div class="blacksmith-subcontent active" id="upgrade-content">
                        <div class="blacksmith-items" id="upgrade-items">
                            <!-- Upgrade items will be populated by JavaScript -->
                        </div>
                    </div>

                    <div class="blacksmith-subcontent" id="dismantle-content">
                        <div class="blacksmith-items" id="dismantle-items">
                            <!-- Dismantle items will be populated by JavaScript -->
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="tab-content" id="location">
            <div class="location-panel">
                <h2 class="location-title">Мир Эмона</h2>
                <p class="location-desc">
                    Исследуйте различные локации, сражайтесь с монстрами и находите сокровища.
                    Будьте осторожны - некоторые области могут быть опасны для неподготовленных путешественников.
                </p>

                <div class="location-map" id="location-map">
                    <!-- Map will be populated by JavaScript -->
                </div>

                <div class="locations-grid" id="locations-grid">
                    <!-- Locations will be populated by JavaScript -->
                </div>
            </div>
        </div>

        <div class="tab-content" id="combat">
            <div class="combat-screen">
                <div class="combat-header">
                    <div class="combatant">
                        <div class="combat-avatar" id="player-combat-avatar"></div>
                        <div class="combat-health">
                            <div class="combat-health-fill" id="player-health-bar"></div>
                        </div>
                        <div id="player-combat-health">100/100</div>
                        <div class="combat-skills" id="player-combat-skills">
                            <!-- Player skills will be populated here -->
                        </div>
                    </div>
                    <div>VS</div>
                    <div class="combatant">
                        <div class="combat-avatar" id="enemy-combat-avatar"></div>
                        <div class="combat-health">
                            <div class="combat-health-fill" id="enemy-health-bar"></div>
                        </div>
                        <div id="enemy-combat-health">50/50</div>
                        <div class="combat-skills" id="enemy-combat-skills">
                            <!-- Enemy skills will be populated here -->
                        </div>
                    </div>
                </div>

                <div class="combat-log" id="combat-log">
                    <div class="log-entry">Бой начинается!</div>
                </div>

                <div class="combat-actions">
                    <button class="combat-btn attack" id="attack-btn">Атака</button>
                    <button class="combat-btn" id="skill-btn">Умение</button>
                    <button class="combat-btn" id="item-btn">Предмет</button>
                    <button class="combat-btn" id="flee-btn">Бегство</button>
                </div>
            </div>
        </div>

        <div class="tab-content" id="loot">
            <div class="loot-screen">
                <h2>Добыча</h2>
                <p>Вы победили врага и нашли следующие предметы:</p>

                <div class="loot-items" id="loot-items">
                    <!-- Loot items will be populated here -->
                </div>

                <button class="combat-btn" id="take-loot-btn">Забрать все</button>
            </div>
        </div>

        <button class="start-button" id="start-button">Начать игру</button>
    </div>

    <div class="level-up-notification" id="level-up-notification">
        <span>🎉 Поздравляем! Вы достигли уровня </span>
        <span id="level-number">2</span>
    </div>

    <div class="item-context-menu" id="item-context-menu">
        <button class="item-context-btn use">Использовать</button>
        <button class="item-context-btn equip">Экипировать</button>
        <button class="item-context-btn sell">Продать</button>
        <button class="item-context-btn dismantle">Разобрать</button>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Game Data
            const classData = {
                warrior: {
                    name: "Воин",
                    icon: "⚔️",
                    baseImage: "url('data:image/svg+xml;utf8,<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 100 100\"><circle cx=\"50\" cy=\"50\" r=\"40\" fill=\"%23f59e0b\"/></svg>')",
                    stats: { health: 100, mana: 50, strength: 5, agility: 5, vitality: 5, intellect: 5 },
                    skills: [
                        {
                            name: "Мощный удар",
                            icon: "url('data:image/svg+xml;utf8,<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 100 100\"><rect x=\"20\" y=\"20\" width=\"60\" height=\"60\" fill=\"%23f59e0b\" stroke=\"%23334155\" stroke-width=\"2\"/></svg>')",
                            desc: "Наносит 150% урона",
                            cost: "10 маны",
                            level: 1,
                            maxLevel: 5,
                            type: "attack",
                            effect: { damageMultiplier: 1.5 }
                        },
                        {
                            name: "Берсерк",
                            icon: "url('data:image/svg+xml;utf8,<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 100 100\"><circle cx=\"50\" cy=\"50\" r=\"40\" fill=\"%23ef4444\" stroke=\"%23334155\" stroke-width=\"2\"/></svg>')",
                            desc: "Увеличивает силу на 20%",
                            cost: "15 маны",
                            level: 0,
                            maxLevel: 3,
                            reqLevel: 2,
                            type: "buff",
                            effect: { stat: "strength", value: 0.2, duration: 3 }
                        },
                        {
                            name: "Щитовая стена",
                            icon: "url('data:image/svg+xml;utf8,<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 100 100\"><rect x=\"10\" y=\"25\" width=\"80\" height=\"50\" fill=\"%233b82f6\" stroke=\"%23334155\" stroke-width=\"2\"/></svg>')",
                            desc: "Блокирует следующую атаку",
                            cost: "20 маны",
                            level: 0,
                            maxLevel: 3,
                            reqLevel: 3,
                            type: "defense",
                            effect: { blockNext: true }
                        },
                        {
                            name: "Рывок",
                            icon: "url('data:image/svg+xml;utf8,<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 100 100\"><polygon points=\"50,10 90,50 50,90 10,50\" fill=\"%2310b981\" stroke=\"%23334155\" stroke-width=\"2\"/></svg>')",
                            desc: "Быстрое перемещение к цели",
                            cost: "8 маны",
                            level: 0,
                            maxLevel: 3,
                            reqLevel: 4,
                            type: "movement",
                            effect: { extraAttack: true }
                        },
                        {
                            name: "Размашистый удар",
                            icon: "url('data:image/svg+xml;utf8,<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 100 100\"><path d=\"M10,50 Q50,10 90,50 Q50,90 10,50\" fill=\"%23f59e0b\" stroke=\"%23334155\" stroke-width=\"2\"/></svg>')",
                            desc: "Атака по области",
                            cost: "25 маны",
                            level: 0,
                            maxLevel: 3,
                            reqLevel: 5,
                            type: "attack",
                            effect: { aoe: true, damageMultiplier: 0.8 }
                        },
                        {
                            name: "Воинский клич",
                            icon: "url('data:image/svg+xml;utf8,<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 100 100\"><circle cx=\"50\" cy=\"50\" r=\"40\" fill=\"none\" stroke=\"%23f59e0b\" stroke-width=\"5\"/><text x=\"50\" y=\"55\" text-anchor=\"middle\" fill=\"%23334155\" font-size=\"20\">!</text></svg>')",
                            desc: "Увеличивает атаку всей группы",
                            cost: "30 маны",
                            level: 0,
                            maxLevel: 2,
                            reqLevel: 6,
                            type: "buff",
                            effect: { stat: "attack", value: 0.15, duration: 3, partyWide: true }
                        }
                    ]
                },
                mage: {
                    name: "Маг",
                    icon: "🧙",
                    baseImage: "url('data:image/svg+xml;utf8,<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 100 100\"><circle cx=\"50\" cy=\"50\" r=\"40\" fill=\"%233b82f6\"/></svg>')",
                    stats: { health: 80, mana: 100, strength: 5, agility: 5, vitality: 5, intellect: 5 },
                    skills: [
                        {
                            name: "Огненный шар",
                            icon: "url('data:image/svg+xml;utf8,<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 100 100\"><circle cx=\"50\" cy=\"50\" r=\"40\" fill=\"%23ef4444\" stroke=\"%23334155\" stroke-width=\"2\"/></svg>')",
                            desc: "Наносит 12-14 урона",
                            cost: "15 маны",
                            level: 1,
                            maxLevel: 5,
                            type: "attack",
                            effect: { damage: [12, 14] }
                        },
                        {
                            name: "Ледяная стрела",
                            icon: "url('data:image/svg+xml;utf8,<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 100 100\"><polygon points=\"50,10 60,40 90,40 65,55 75,90 50,70 25,90 35,55 10,40 40,40\" fill=\"%236366f1\" stroke=\"%23334155\" stroke-width=\"2\"/></svg>')",
                            desc: "Замедление цели",
                            cost: "12 маны",
                            level: 0,
                            maxLevel: 3,
                            reqLevel: 2,
                            type: "debuff",
                            effect: { stat: "speed", value: -0.3, duration: 2 }
                        },
                        {
                            name: "Молния",
                            icon: "url('data:image/svg+xml;utf8,<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 100 100\"><path d=\"M30,10 L50,40 L40,40 L60,90 L50,60 L70,60 L50,10\" fill=\"%23f59e0b\" stroke=\"%23334155\" stroke-width=\"2\"/></svg>')",
                            desc: "16-18 урона",
                            cost: "18 маны",
                            level: 0,
                            maxLevel: 3,
                            reqLevel: 3,
                            type: "attack",
                            effect: { damage: [16, 18] }
                        },
                        {
                            name: "Магический щит",
                            icon: "url('data:image/svg+xml;utf8,<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 100 100\"><rect x=\"20\" y=\"20\" width=\"60\" height=\"60\" fill=\"%233b82f6\" stroke=\"%23334155\" stroke-width=\"2\"/><circle cx=\"50\" cy=\"50\" r=\"20\" fill=\"%236366f1\" stroke=\"%23334155\" stroke-width=\"2\"/></svg>')",
                            desc: "Поглощение урона",
                            cost: "25 маны",
                            level: 0,
                            maxLevel: 3,
                            reqLevel: 4,
                            type: "defense",
                            effect: { damageReduction: 0.5, duration: 2 }
                        },
                        {
                            name: "Телепорт",
                            icon: "url('data:image/svg+xml;utf8,<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 100 100\"><circle cx=\"50\" cy=\"50\" r=\"40\" fill=\"none\" stroke=\"%2310b981\" stroke-width=\"5\" stroke-dasharray=\"10,5\"/><circle cx=\"50\" cy=\"50\" r=\"20\" fill=\"%2310b981\" stroke=\"%23334155\" stroke-width=\"2\"/></svg>')",
                            desc: "Короткое перемещение",
                            cost: "20 маны",
                            level: 0,
                            maxLevel: 3,
                            reqLevel: 5,
                            type: "movement",
                            effect: { avoidNextAttack: true }
                        },
                        {
                            name: "Воскрешение",
                            icon: "url('data:image/svg+xml;utf8,<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 100 100\"><path d=\"M50,20 A30,30 0 1,1 50,80 A30,30 0 1,1 50,20\" fill=\"%23ef4444\" stroke=\"%23334155\" stroke-width=\"2\"/><text x=\"50\" y=\"55\" text-anchor=\"middle\" fill=\"%23334155\" font-size=\"20\">+</text></svg>')",
                            desc: "Воскрешает союзника",
                            cost: "50 маны",
                            level: 0,
                            maxLevel: 1,
                            reqLevel: 10,
                            type: "heal",
                            effect: { revive: true, healthRestore: 0.5 }
                        }
                    ]
                },
                archer: {
                    name: "Лучник",
                    icon: "🏹",
                    baseImage: "url('data:image/svg+xml;utf8,<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 100 100\"><circle cx=\"50\" cy=\"50\" r=\"40\" fill=\"%2310b981\"/></svg>')",
                    stats: { health: 90, mana: 70, strength: 5, agility: 5, vitality: 5, intellect: 5 },
                    skills: [
                        {
                            name: "Точный выстрел",
                            icon: "url('data:image/svg+xml;utf8,<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 100 100\"><circle cx=\"50\" cy=\"50\" r=\"40\" fill=\"%2310b981\" stroke=\"%23334155\" stroke-width=\"2\"/><circle cx=\"50\" cy=\"50\" r=\"10\" fill=\"%23334155\"/></svg>')",
                            desc: "100% шанс попадания",
                            cost: "12 маны",
                            level: 1,
                            maxLevel: 5,
                            type: "attack",
                            effect: { guaranteedHit: true, critChance: 0.3 }
                        },
                        {
                            name: "Дождь стрел",
                            icon: "url('data:image/svg+xml;utf8,<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 100 100\"><line x1=\"10\" y1=\"10\" x2=\"90\" y2=\"90\" stroke=\"%2310b981\" stroke-width=\"5\"/><line x1=\"30\" y1=\"10\" x2=\"70\" y2=\"90\" stroke=\"%2310b981\" stroke-width=\"5\"/><line x1=\"50\" y1=\"10\" x2=\"50\" y2=\"90\" stroke=\"%2310b981\" stroke-width=\"5\"/><line x1=\"70\" y1=\"10\" x2=\"30\" y2=\"90\" stroke=\"%2310b981\" stroke-width=\"5\"/><line x1=\"90\" y1=\"10\" x2=\"10\" y2=\"90\" stroke=\"%2310b981\" stroke-width=\"5\"/></svg>')",
                            desc: "Атака по области",
                            cost: "20 маны",
                            level: 0,
                            maxLevel: 3,
                            reqLevel: 2,
                            type: "attack",
                            effect: { aoe: true, damageMultiplier: 0.7 }
                        },
                        {
                            name: "Скрытность",
                            icon: "url('data:image/svg+xml;utf8,<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 100 100\"><rect x=\"20\" y=\"20\" width=\"60\" height=\"60\" fill=\"%2394a3b8\" stroke=\"%23334155\" stroke-width=\"2\" opacity=\"0.7\"/></svg>')",
                            desc: "Невидимость на 10 сек",
                            cost: "15 маны",
                            level: 0,
                            maxLevel: 3,
                            reqLevel: 3,
                            type: "buff",
                            effect: { stealth: true, duration: 3 }
                        },
                        {
                            name: "Ядовитая стрела",
                            icon: "url('data:image/svg+xml;utf8,<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 100 100\"><path d=\"M30,70 Q50,10 70,70\" fill=\"%2355aa55\" stroke=\"%23334155\" stroke-width=\"2\"/><circle cx=\"50\" cy=\"30\" r=\"15\" fill=\"%2355aa55\" stroke=\"%23334155\" stroke-width=\"2\"/></svg>')",
                            desc: "Наносит урон со временем",
                            cost: "10 маны",
                            level: 0,
                            maxLevel: 3,
                            reqLevel: 4,
                            type: "debuff",
                            effect: { dot: true, damage: 5, duration: 3 }
                        },
                        {
                            name: "Уклонение",
                            icon: "url('data:image/svg+xml;utf8,<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 100 100\"><path d=\"M30,50 Q50,20 70,50 Q50,80 30,50\" fill=\"%2310b981\" stroke=\"%23334155\" stroke-width=\"2\"/></svg>')",
                            desc: "Увеличивает шанс уклонения",
                            cost: "15 маны",
                            level: 0,
                            maxLevel: 3,
                            reqLevel: 5,
                            type: "buff",
                            effect: { dodgeChance: 0.4, duration: 2 }
                        },
                        {
                            name: "Смертельный выстрел",
                            icon: "url('data:image/svg+xml;utf8,<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 100 100\"><circle cx=\"50\" cy=\"50\" r=\"40\" fill=\"%23334155\" stroke=\"%2310b981\" stroke-width=\"5\"/><text x=\"50\" y=\"55\" text-anchor=\"middle\" fill=\"%2310b981\" font-size=\"20\">!</text></svg>')",
                            desc: "Критический урон цели",
                            cost: "30 маны",
                            level: 0,
                            maxLevel: 2,
                            reqLevel: 8,
                            type: "attack",
                            effect: { damageMultiplier: 2.5, cooldown: 3 }
                        }
                    ]
                },
                rogue: {
                    name: "Разбойник",
                    icon: "🗡️",
                    baseImage: "url('data:image/svg+xml;utf8,<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 100 100\"><circle cx=\"50\" cy=\"50\" r=\"40\" fill=\"%2394a3b8\"/></svg>')",
                    stats: { health: 85, mana: 60, strength: 5, agility: 5, vitality: 5, intellect: 5 },
                    skills: [
                        {
                            name: "Смертельный удар",
                            icon: "url('data:image/svg+xml;utf8,<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 100 100\"><path d=\"M30,70 L50,30 L70,70\" fill=\"%23334155\" stroke=\"%2394a3b8\" stroke-width=\"2\"/></svg>')",
                            desc: "Критический удар в спину",
                            cost: "15 маны",
                            level: 1,
                            maxLevel: 5,
                            type: "attack",
                            effect: { backstab: true, damageMultiplier: 2 }
                        },
                        {
                            name: "Отравление",
                            icon: "url('data:image/svg+xml;utf8,<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 100 100\"><circle cx=\"50\" cy=\"50\" r=\"40\" fill=\"%2355aa55\" stroke=\"%23334155\" stroke-width=\"2\"/><path d=\"M30,30 L70,70 M70,30 L30,70\" stroke=\"%23334155\" stroke-width=\"5\"/></svg>')",
                            desc: "Наносит урон со временем",
                            cost: "8 маны",
                            level: 0,
                            maxLevel: 3,
                            reqLevel: 2,
                            type: "debuff",
                            effect: { dot: true, damage: 7, duration: 3 }
                        },
                        {
                            name: "Уклонение",
                            icon: "url('data:image/svg+xml;utf8,<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 100 100\"><path d=\"M30,50 Q50,20 70,50 Q50,80 30,50\" fill=\"%2394a3b8\" stroke=\"%23334155\" stroke-width=\"2\"/></svg>')",
                            desc: "Увеличивает шанс уклонения",
                            cost: "12 маны",
                            level: 0,
                            maxLevel: 3,
                            reqLevel: 3,
                            type: "buff",
                            effect: { dodgeChance: 0.5, duration: 2 }
                        },
                        {
                            name: "Бросок ножей",
                            icon: "url('data:image/svg+xml;utf8,<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 100 100\"><path d=\"M20,20 L40,40 M30,30 L50,50 M40,40 L60,60\" stroke=\"%23334155\" stroke-width=\"5\"/><path d=\"M80,20 L60,40 M70,30 L50,50 M60,40 L40,60\" stroke=\"%23334155\" stroke-width=\"5\"/></svg>')",
                            desc: "Атака несколькими целями",
                            cost: "10 маны",
                            level: 0,
                            maxLevel: 3,
                            reqLevel: 4,
                            type: "attack",
                            effect: { multiTarget: 3, damageMultiplier: 0.6 }
                        },
                        {
                            name: "Незаметность",
                            icon: "url('data:image/svg+xml;utf8,<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 100 100\"><rect x=\"20\" y=\"20\" width=\"60\" height=\"60\" fill=\"%23334155\" stroke=\"%2394a3b8\" stroke-width=\"2\" opacity=\"0.5\"/></svg>')",
                            desc: "Становится невидимым",
                            cost: "25 маны",
                            level: 0,
                            maxLevel: 2,
                            reqLevel: 6,
                            type: "buff",
                            effect: { stealth: true, duration: 3 }
                        },
                        {
                            name: "Фанатизм",
                            icon: "url('data:image/svg+xml;utf8,<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 100 100\"><circle cx=\"50\" cy=\"50\" r=\"40\" fill=\"%23ef4444\" stroke=\"%23334155\" stroke-width=\"2\"/><text x=\"50\" y=\"55\" text-anchor=\"middle\" fill=\"%23334155\" font-size=\"20\">F</text></svg>')",
                            desc: "Увеличивает скорость атаки",
                            cost: "20 маны",
                            level: 0,
                            maxLevel: 2,
                            reqLevel: 7,
                            type: "buff",
                            effect: { attackSpeed: 0.5, duration: 3 }
                        }
                    ]
                }
            };

            const itemsData = {
                weapons: [
                    { id: "w1", name: "Деревянный меч", icon: "⚔️", type: "weapon", price: 20, sellPrice: 5, attack: "3-5", reqLevel: 1, quality: "common", image: "url('data:image/svg+xml;utf8,<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 100 100\"><rect x=\"40\" y=\"20\" width=\"20\" height=\"60\" fill=\"%23a0a0a0\" stroke=\"%23334155\" stroke-width=\"2\"/><rect x=\"30\" y=\"30\" width=\"40\" height=\"10\" fill=\"%23a0a0a0\" stroke=\"%23334155\" stroke-width=\"2\"/></svg>')" },
                    { id: "w2", name: "Стальной меч", icon: "⚔️", type: "weapon", price: 100, sellPrice: 25, attack: "8-12", reqLevel: 3, quality: "uncommon", image: "url('data:image/svg+xml;utf8,<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 100 100\"><rect x=\"40\" y=\"10\" width=\"20\" height=\"70\" fill=\"%23cccccc\" stroke=\"%23334155\" stroke-width=\"2\"/><rect x=\"30\" y=\"20\" width=\"40\" height=\"15\" fill=\"%23cccccc\" stroke=\"%23334155\" stroke-width=\"2\"/><circle cx=\"50\" cy=\"85\" r=\"5\" fill=\"%23ffd700\" stroke=\"%23334155\" stroke-width=\"2\"/></svg>')" },
                    { id: "w3", name: "Посох новичка", icon:"🔮", type: "weapon", price: 25, sellPrice: 6, attack: "2-4", magic: "5-7", reqLevel: 1, quality: "common", image: "url('data:image/svg+xml;utf8,<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 100 100\"><rect x=\"45\" y=\"10\" width=\"10\" height=\"70\" fill=\"%23a0a0a0\" stroke=\"%23334155\" stroke-width=\"2\"/><circle cx=\"50\" cy=\"20\" r=\"15\" fill=\"%233b82f6\" stroke=\"%23334155\" stroke-width=\"2\"/></svg>')" },
                    { id: "w4", name: "Длинный лук", icon: "🏹", type: "weapon", price: 80, sellPrice: 20, attack: "6-10", reqLevel: 2, quality: "uncommon", image: "url('data:image/svg+xml;utf8,<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 100 100\"><path d=\"M20,50 Q50,20 80,50\" fill=\"none\" stroke=\"%23a0a0a0\" stroke-width=\"5\"/><line x1=\"80\" y1=\"50\" x2=\"90\" y2=\"45\" stroke=\"%23334155\" stroke-width=\"3\"/></svg>')" },
                    { id: "w5", name: "Кинжал разбойника", icon: "🗡️", type: "weapon", price: 70, sellPrice: 17, attack: "5-9", reqLevel: 2, quality: "uncommon", image: "url('data:image/svg+xml;utf8,<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 100 100\"><path d=\"M50,10 L70,40 L50,80 L30,40 Z\" fill=\"%23334155\" stroke=\"%2394a3b8\" stroke-width=\"2\"/></svg>')" },
                    { id: "w6", name: "Легендарный клинок", icon: "⚔️", type: "weapon", price: 500, sellPrice: 125, attack: "20-30", reqLevel: 10, quality: "legendary", image: "url('data:image/svg+xml;utf8,<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 100 100\"><rect x=\"40\" y=\"5\" width=\"20\" height=\"75\" fill=\"%23ffd700\" stroke=\"%23334155\" stroke-width=\"2\"/><rect x=\"25\" y=\"15\" width=\"50\" height=\"20\" fill=\"%23ffd700\" stroke=\"%23334155\" stroke-width=\"2\"/><circle cx=\"50\" cy=\"85\" r=\"10\" fill=\"%23ff0000\" stroke=\"%23334155\" stroke-width=\"2\"/></svg>')" }
                ],
                armor: [
                    { id: "a1", name: "Кожаная броня", icon: "🛡️", type: "armor", price: 40, sellPrice: 10, defense: 5, reqLevel: 1, quality: "common", image: "url('data:image/svg+xml;utf8,<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 100 100\"><rect x=\"20\" y=\"20\" width=\"60\" height=\"60\" fill=\"%23a0a0a0\" stroke=\"%23334155\" stroke-width=\"2\"/><rect x=\"30\" y=\"30\" width=\"40\" height=\"40\" fill=\"%23a0a0a0\" stroke=\"%23334155\" stroke-width=\"2\"/></svg>')" },
                    { id: "a2", name: "Кольчуга", icon: "🥋", type: "armor", price: 120, sellPrice: 30, defense: 12, reqLevel: 3, quality: "uncommon", image: "url('data:image/svg+xml;utf8,<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 100 100\"><rect x=\"20\" y=\"20\" width=\"60\" height=\"60\" fill=\"%23cccccc\" stroke=\"%23334155\" stroke-width=\"2\"/><circle cx=\"50\" cy=\"50\" r=\"20\" fill=\"%23cccccc\" stroke=\"%23334155\" stroke-width=\"2\"/></svg>')" },
                    { id: "a3", name: "Мантия мага", icon: "🧥", type: "armor", price: 60, sellPrice: 15, defense: 3, magic: 5, reqLevel: 2, quality: "uncommon", image: "url('data:image/svg+xml;utf8,<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 100 100\"><path d=\"M20,20 L50,50 L80,20 L80,80 L20,80 Z\" fill=\"%233b82f6\" stroke=\"%23334155\" stroke-width=\"2\"/></svg>')" },
                    { id: "a4", name: "Доспех дракона", icon: "🐉", type: "armor", price: 400, sellPrice: 100, defense: 25, reqLevel: 8, quality: "epic", image: "url('data:image/svg+xml;utf8,<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 100 100\"><rect x=\"20\" y=\"20\" width=\"60\" height=\"60\" fill=\"%23ff0000\" stroke=\"%23334155\" stroke-width=\"2\"/><path d=\"M30,30 L40,40 M50,30 L60,40 M70,30 L80,40 M30,50 L40,60 M50,50 L60,60 M70,50 L80,60\" stroke=\"%23ffd700\" stroke-width=\"3\"/></svg>')" }
                ],
                consumables: [
                    { id: "c1", name: "Зелье здоровья", icon: "🧪", type: "consumable", price: 15, sellPrice: 3, effect: { health: 30 } },
                    { id: "c2", name: "Зелье маны", icon: "🧪", type: "consumable", price: 20, sellPrice: 5, effect: { mana: 25 } },
                    { id: "c3", name: "Зелье силы", icon: "🧪", type: "consumable", price: 30, sellPrice: 7, effect: { buff: "strength", value: 2, duration: 300 } },
                    { id: "c4", name: "Зелье ловкости", icon: "🧪", type: "consumable", price: 30, sellPrice: 7, effect: { buff: "agility", value: 2, duration: 300 } }
                ],
                materials: [
                    { id: "m1", name: "Железная руда", icon: "⛰️", type: "material", price: 10, sellPrice: 2, quality: "common" },
                    { id: "m2", name: "Кожа", icon: "🐄", type: "material", price: 8, sellPrice: 1, quality: "common" },
                    { id: "m3", name: "Магический кристалл", icon: "💎", type: "material", price: 50, sellPrice: 12, quality: "uncommon" },
                    { id: "m4", name: "Руна усиления", icon: "🔰", type: "material", price: 100, sellPrice: 25, quality: "rare" }
                ]
            };

            const craftingData = [
                { id: "cr1", name: "Улучшение меча", icon: "⚔️", type: "upgrade", materials: [{ id: "m1", count: 3 }, { id: "m2", count: 2 }], result: "w2", price: 50 },
                { id: "cr2", name: "Улучшение брони", icon: "🛡️", type: "upgrade", materials: [{ id: "m1", count: 2 }, { id: "m2", count: 3 }], result: "a2", price: 80 },
                { id: "cr3", name: "Создание зелья силы", icon: "🧪", type: "craft", materials: [{ id: "m3", count: 1 }, { id: "m1", count: 2 }], result: "c3", price: 20 }
            ];

            const locationsData = [
                {
                    id: "l1",
                    name: "Лесная опушка",
                    type: "Лес",
                    desc: "Тихий лес на окраине города. Идеальное место для начинающих искателей приключений.",
                    monsters: [
                        { name: "Лесной волк", icon: "🐺", image: "url('data:image/svg+xml;utf8,<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 100 100\"><ellipse cx=\"50\" cy=\"60\" rx=\"30\" ry=\"40\" fill=\"%23cccccc\" stroke=\"%23334155\" stroke-width=\"2\"/><ellipse cx=\"50\" cy=\"30\" rx=\"20\" ry=\"25\" fill=\"%23cccccc\" stroke=\"%23334155\" stroke-width=\"2\"/><circle cx=\"40\" cy=\"25\" r=\"5\" fill=\"%23334155\"/><circle cx=\"60\" cy=\"25\" r=\"5\" fill=\"%23334155\"/></svg>')", health: 30, maxHealth: 30, attack: "5-8", exp: 15, gold: "5-10", skills: ["Укус", "Рывок"] },
                        { name: "Дикий кабан", icon: "🐗", image: "url('data:image/svg+xml;utf8,<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 100 100\"><ellipse cx=\"50\" cy=\"60\" rx=\"35\" ry=\"40\" fill=\"%23a0a0a0\" stroke=\"%23334155\" stroke-width=\"2\"/><ellipse cx=\"50\" cy=\"30\" rx=\"25\" ry=\"30\" fill=\"%23a0a0a0\" stroke=\"%23334155\" stroke-width=\"2\"/><path d=\"M30,20 L20,10 M70,20 L80,10\" stroke=\"%23334155\" stroke-width=\"3\"/></svg>')", health: 40, maxHealth: 40, attack: "6-9", exp: 20, gold: "7-12", skills: ["Таран", "Топот"] }
                    ],
                    reqLevel: 1,
                    loot: ["w1", "a1", "c1", "m1", "m2"]
                },
                {
                    id: "l2",
                    name: "Горные пещеры",
                    type: "Горы",
                    desc: "Скалистые пещеры, где обитают более опасные существа.",
                    monsters: [
                        { name: "Пещерный медведь", icon: "🐻", image: "url('data:image/svg+xml;utf8,<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 100 100\"><ellipse cx=\"50\" cy=\"60\" rx=\"35\" ry=\"40\" fill=\"%23755555\" stroke=\"%23334155\" stroke-width=\"2\"/><circle cx=\"50\" cy=\"35\" r=\"25\" fill=\"%23755555\" stroke=\"%23334155\" stroke-width=\"2\"/><circle cx=\"40\" cy=\"30\" r=\"5\" fill=\"%23334155\"/><circle cx=\"60\" cy=\"30\" r=\"5\" fill=\"%23334155\"/></svg>')", health: 60, maxHealth: 60, attack: "10-14", exp: 35, gold: "15-25", skills: ["Мощный удар", "Рев"] },
                        { name: "Гоблин", icon: "👺", image: "url('data:image/svg+xml;utf8,<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 100 100\"><ellipse cx=\"50\" cy=\"60\" rx=\"25\" ry=\"35\" fill=\"%2355aa55\" stroke=\"%23334155\" stroke-width=\"2\"/><circle cx=\"50\" cy=\"35\" r=\"20\" fill=\"%2355aa55\" stroke=\"%23334155\" stroke-width=\"2\"/><circle cx=\"40\" cy=\"30\" r=\"5\" fill=\"%23334155\"/><circle cx=\"60\" cy=\"30\" r=\"5\" fill=\"%23334155\"/></svg>')", health: 45, maxHealth: 45, attack: "8-12", exp: 25, gold: "10-20", skills: ["Удар дубиной", "Побег"] }
                    ],
                    reqLevel: 2,
                    loot: ["w2", "w4", "a2", "c2", "m1", "m2", "m3"]
                },
                {
                    id: "l3",
                    name: "Заброшенные руины",
                    type: "Руины",
                    desc: "Древние руины, хранящие множество секретов и опасностей.",
                    monsters: [
                        { name: "Скелет", icon: "💀", image: "url('data:image/svg+xml;utf8,<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 100 100\"><circle cx=\"50\" cy=\"30\" r=\"20\" fill=\"%23cccccc\" stroke=\"%23334155\" stroke-width=\"2\"/><rect x=\"40\" y=\"50\" width=\"20\" height=\"40\" fill=\"%23cccccc\" stroke=\"%23334155\" stroke-width=\"2\"/><line x1=\"30\" y1=\"50\" x2=\"70\" y2=\"50\" stroke=\"%23334155\" stroke-width=\"3\"/></svg>')", health: 50, maxHealth: 50, attack: "12-16", exp: 40, gold: "20-30", skills: ["Костяной удар", "Страх"] },
                        { name: "Призрак", icon: "👻", image: "url('data:image/svg+xml;utf8,<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 100 100\"><ellipse cx=\"50\" cy=\"40\" rx=\"30\" ry=\"35\" fill=\"%23eeeeee\" stroke=\"%23334155\" stroke-width=\"2\" opacity=\"0.7\"/><circle cx=\"40\" cy=\"30\" r=\"5\" fill=\"%23334155\"/><circle cx=\"60\" cy=\"30\" r=\"5\" fill=\"%23334155\"/></svg>')", health: 40, maxHealth: 40, attack: "15-18", exp: 45, gold: "25-35", skills: ["Ледяное прикосновение", "Невидимость"] }
                    ],
                    reqLevel: 3,
                    loot: ["w3", "w5", "a3", "c3", "c4", "m2", "m3", "m4"]
                },
                {
                    id: "l4",
                    name: "Подземелья тьмы",
                    type: "Подземелье",
                    desc: "Глубокие подземелья, где обитают могущественные существа.",
                    monsters: [
                        { name: "Темный рыцарь", icon: "⚔️", image: "url('data:image/svg+xml;utf8,<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 100 100\"><rect x=\"30\" y=\"20\" width=\"40\" height=\"60\" fill=\"%23334155\" stroke=\"%23000000\" stroke-width=\"2\"/><circle cx=\"50\" cy=\"35\" r=\"15\" fill=\"%23334155\" stroke=\"%23000000\" stroke-width=\"2\"/></svg>')", health: 80, maxHealth: 80, attack: "18-24", exp: 60, gold: "30-45", skills: ["Темный удар", "Щит тьмы"] },
                        { name: "Древний голем", icon: "🗿", image: "url('data:image/svg+xml;utf8,<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 100 100\"><rect x=\"20\" y=\"20\" width=\"60\" height=\"60\" fill=\"%23a0a0a0\" stroke=\"%23334155\" stroke-width=\"2\"/><rect x=\"30\" y=\"30\" width=\"40\" height=\"40\" fill=\"%23a0a0a0\" stroke=\"%23334155\" stroke-width=\"2\"/></svg>')", health: 100, maxHealth: 100, attack: "15-20", exp: 70, gold: "35-50", skills: ["Сокрушительный удар", "Каменная кожа"] }
                    ],
                    reqLevel: 4,
                    loot: ["w2", "w5", "a2", "a3", "c3", "c4", "m3", "m4"]
                },
                {
                    id: "l5",
                    name: "Логово дракона",
                    type: "Пещера",
                    desc: "Опасное логово древнего дракона. Только самые сильные герои могут выжить здесь.",
                    monsters: [
                        { name: "Молодой дракон", icon: "🐲", image: "url('data:image/svg+xml;utf8,<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 100 100\"><ellipse cx=\"50\" cy=\"60\" rx=\"35\" ry=\"40\" fill=\"%23ff0000\" stroke=\"%23334155\" stroke-width=\"2\"/><ellipse cx=\"50\" cy=\"30\" rx=\"25\" ry=\"30\" fill=\"%23ff0000\" stroke=\"%23334155\" stroke-width=\"2\"/><path d=\"M30,20 L20,10 M70,20 L80,10\" stroke=\"%23334155\" stroke-width=\"3\"/></svg>')", health: 120, maxHealth: 120, attack: "25-35", exp: 100, gold: "50-75", skills: ["Огненное дыхание", "Взмах крыльев"] }
                    ],
                    reqLevel: 5,
                    loot: ["w6", "a4", "c3", "c4", "m4"]
                }
            ];

            const buffsData = [
                { id: "b1", name: "Сила", icon: "💪", stat: "strength", value: 2, duration: 300 },
                { id: "b2", name: "Ловкость", icon: "🏃", stat: "agility", value: 2, duration: 300 },
                { id: "b3", name: "Живучесть", icon: "❤️", stat: "vitality", value: 2, duration: 300 },
                { id: "b4", name: "Интеллект", icon: "🧠", stat: "intellect", value: 2, duration: 300 },
                { id: "b5", name: "Защита", icon: "🛡️", stat: "defense", value: 5, duration: 300 },
                { id: "b6", name: "Критический удар", icon: "🎯", stat: "crit", value: 10, duration: 300 }
            ];

            // Game State
            let currentClass = 'warrior';
            let currentGender = 'male';
            let characterName = '';
            let characterLevel = 1;
            let characterXP = 0;
            let xpToNextLevel = 100;
            let statPoints = 0;
            let skillPoints = 0;
            let gold = 50;
            let characterCreated = false;
            let inventory = [];
            let equipped = {
                weapon: null,
                armor: null
            };
            let currentLocation = null;
            let currentEnemy = null;
            let combatActive = false;
            let playerBuffs = [];
            let currentLoot = [];
            let contextMenuItemIndex = -1;

            // DOM Elements
            const tabButtons = document.querySelectorAll('.tab-btn');
            const tabContents = document.querySelectorAll('.tab-content');
            const classOptions = document.querySelectorAll('.class-option');
            const genderOptions = document.querySelectorAll('.gender-option');
            const nicknameInput = document.getElementById('nickname');
            const startButton = document.getElementById('start-button');
            const characterAvatar = document.getElementById('character-avatar');
            const characterNameDisplay = document.getElementById('character-name');
            const characterLevelDisplay = document.getElementById('character-level');
            const characterBase = document.getElementById('character-base');
            const characterWeapon = document.getElementById('character-weapon');
            const characterArmor = document.getElementById('character-armor');
            const headerName = document.getElementById('header-name');
            const headerLevel = document.getElementById('header-level');
            const goldAmount = document.getElementById('gold-amount');
            const statsAvatar = document.getElementById('stats-avatar');
            const weaponSlot = document.getElementById('weapon-slot');
            const armorSlot = document.getElementById('armor-slot');
            const statsName = document.getElementById('stats-name');
            const statsClass = document.getElementById('stats-class');
            const healthValue = document.getElementById('health-value');
            const manaValue = document.getElementById('mana-value');
            const xpValue = document.getElementById('xp-value');
            const healthBar = document.getElementById('health-bar');
            const manaBar = document.getElementById('mana-bar');
            const xpBar = document.getElementById('xp-bar');
            const strengthValue = document.getElementById('strength-value');
            const agilityValue = document.getElementById('agility-value');
            const vitalityValue = document.getElementById('vitality-value');
            const intellectValue = document.getElementById('intellect-value');
            const skillsGrid = document.getElementById('skills-grid');
            const inventoryGrid = document.getElementById('inventory');
            const shopItems = document.getElementById('shop-items');
            const blacksmithItems = document.getElementById('blacksmith-items');
            const upgradeItems = document.getElementById('upgrade-items');
            const dismantleItems = document.getElementById('dismantle-items');
            const locationsGrid = document.getElementById('locations-grid');
            const locationMap = document.getElementById('location-map');
            const upgradeButtons = document.querySelectorAll('.upgrade-btn');
            const levelUpNotification = document.getElementById('level-up-notification');
            const tavernTabs = document.querySelectorAll('.tavern-tab');
            const tavernContents = document.querySelectorAll('.tavern-content');
            const blacksmithTabs = document.querySelectorAll('.blacksmith-tabs .tavern-tab');
            const blacksmithSubcontents = document.querySelectorAll('.blacksmith-subcontent');
            const buffsContainer = document.getElementById('buffs-container');
            const contextMenu = document.getElementById('item-context-menu');

            // Initialize
            initTabs();
            initCharacterCreation();
            initUpgradeButtons();
            initTavernTabs();
            initBlacksmithTabs();
            updateCharacterPreview();
            renderSkills(currentClass);
            renderShop();
            renderBlacksmith();
            renderLocations();

            // Tab System
            function initTabs() {
                tabButtons.forEach(button => {
                    button.addEventListener('click', function() {
                        const tabId = this.getAttribute('data-tab');

                        // Update active tab button
                        tabButtons.forEach(btn => btn.classList.remove('active'));
                        this.classList.add('active');

                        // Show active tab content
                        tabContents.forEach(content => {
                            content.classList.remove('active');
                            if (content.id === tabId) {
                                content.classList.add('active');
                            }
                        });
                    });
                });
            }

            // Tavern Tab System
            function initTavernTabs() {
                tavernTabs.forEach(tab => {
                    tab.addEventListener('click', function() {
                        const tabId = this.getAttribute('data-tab');

                        // Update active tab button
                        tavernTabs.forEach(t => t.classList.remove('active'));
                        this.classList.add('active');

                        // Show active tab content
                        tavernContents.forEach(content => {
                            content.classList.remove('active');
                            if (content.id === `${tabId}-content`) {
                                content.classList.add('active');
                            }
                        });
                    });
                });
            }

            // Blacksmith Tab System
            function initBlacksmithTabs() {
                blacksmithTabs.forEach(tab => {
                    tab.addEventListener('click', function() {
                        const subtabId = this.getAttribute('data-subtab');

                        // Update active tab button
                        blacksmithTabs.forEach(t => t.classList.remove('active'));
                        this.classList.add('active');

                        // Show active subcontent
                        blacksmithSubcontents.forEach(content => {
                            content.classList.remove('active');
                            if (content.id === `${subtabId}-content`) {
                                content.classList.add('active');
                            }
                        });
                    });
                });
            }

            // Character Creation
            function initCharacterCreation() {
                // Class selection
                classOptions.forEach(option => {
                    option.addEventListener('click', function() {
                        if (characterCreated) return;

                        classOptions.forEach(opt => opt.classList.remove('selected'));
                        this.classList.add('selected');
                        currentClass = this.getAttribute('data-class');
                        updateCharacterPreview();
                        renderSkills(currentClass);
                    });
                });

                // Gender selection
                genderOptions.forEach(option => {
                    option.addEventListener('click', function() {
                        if (characterCreated) return;

                        genderOptions.forEach(opt => opt.classList.remove('selected'));
                        this.classList.add('selected');
                        currentGender = this.getAttribute('data-gender');
                        updateCharacterPreview();
                    });
                });

                // Nickname input
                nicknameInput.addEventListener('input', function() {
                    characterName = this.value;
                    updateCharacterPreview();
                });
            }

            // Upgrade Buttons
            function initUpgradeButtons() {
                upgradeButtons.forEach(button => {
                    button.addEventListener('click', function() {
                        if (statPoints <= 0) return;

                        const stat = this.getAttribute('data-stat');
                        upgradeStat(stat);
                    });
                });
            }

            // Upgrade Stat
            function upgradeStat(stat) {
                if (statPoints <= 0) return;

                const currentValue = parseInt(document.getElementById(`${stat}-value`).textContent);

                document.getElementById(`${stat}-value`).textContent = currentValue + 1;
                statPoints--;

                // Update derived stats
                updateDerivedStats();

                // Check if we need to disable upgrade buttons
                if (statPoints <= 0) {
                    upgradeButtons.forEach(btn => btn.disabled = true);
                }
            }

            // Update Derived Stats
            function updateDerivedStats() {
                const strength = parseInt(strengthValue.textContent);
                const agility = parseInt(agilityValue.textContent);
                const vitality = parseInt(vitalityValue.textContent);
                const intellect = parseInt(intellectValue.textContent);

                // Apply buffs
                let strengthBonus = 0;
                let agilityBonus = 0;
                let vitalityBonus = 0;
                let intellectBonus = 0;
                let defenseBonus = 0;
                let critBonus = 0;

                playerBuffs.forEach(buff => {
                    if (buff.stat === 'strength') strengthBonus += buff.value;
                    if (buff.stat === 'agility') agilityBonus += buff.value;
                    if (buff.stat === 'vitality') vitalityBonus += buff.value;
                    if (buff.stat === 'intellect') intellectBonus += buff.value;
                    if (buff.stat === 'defense') defenseBonus += buff.value;
                    if (buff.stat === 'crit') critBonus += buff.value;
                });

                // Update health based on vitality
                const classInfo = classData[currentClass];
                const baseHealth = classInfo.stats.health;
                const health = baseHealth + ((vitality + vitalityBonus) * 5);
                healthValue.textContent = `${health} / ${health}`;
                healthBar.style.width = '100%';

                // Update mana based on intellect
                const baseMana = classInfo.stats.mana;
                const mana = baseMana + ((intellect + intellectBonus) * 3);
                manaValue.textContent = `${mana} / ${mana}`;
                manaBar.style.width = '100%';

                // Update attack based on strength/agility and weapon
                let attackMin = Math.floor((strength + strengthBonus) * 0.8 + (agility + agilityBonus) * 0.2);
                let attackMax = Math.floor((strength + strengthBonus) * 1.2 + (agility + agilityBonus) * 0.3);

                if (equipped.weapon) {
                    const weapon = itemsData.weapons.find(w => w.id === equipped.weapon);
                    if (weapon) {
                        const weaponAttack = weapon.attack.split('-').map(Number);
                        attackMin += weaponAttack[0];
                        attackMax += weaponAttack[1];
                    }
                }

                document.getElementById('attack-value').textContent = `${attackMin}-${attackMax}`;

                // Update defense based on vitality and armor
                let defense = Math.floor((vitality + vitalityBonus) * 1.2) + defenseBonus;

                if (equipped.armor) {
                    const armor = itemsData.armor.find(a => a.id === equipped.armor);
                    if (armor) {
                        defense += armor.defense;
                    }
                }

                document.getElementById('defense-value').textContent = defense;

                // Update crit based on agility
                document.getElementById('crit-value').textContent = `${Math.min(5 + (agility + agilityBonus) * 0.5 + critBonus, 50).toFixed(1)}%`;
            }

            // Update Character Preview
            function updateCharacterPreview() {
                const classInfo = classData[currentClass];
                const genderIcon = currentGender === 'male' ? '👨' : '👩';

                // Update avatar
                characterAvatar.textContent = genderIcon + ' ' + classInfo.icon;

                // Update character visual
                characterBase.style.backgroundImage = classInfo.baseImage;

                // Update weapon visual
                if (equipped.weapon) {
                    const weapon = itemsData.weapons.find(w => w.id === equipped.weapon);
                    if (weapon && weapon.image) {
                        characterWeapon.style.backgroundImage = weapon.image;
                        characterWeapon.style.display = 'block';
                    }
                } else {
                    characterWeapon.style.display = 'none';
                }

                // Update armor visual
                if (equipped.armor) {
                    const armor = itemsData.armor.find(a => a.id === equipped.armor);
                    if (armor && armor.image) {
                        characterArmor.style.backgroundImage = armor.image;
                        characterArmor.style.display = 'block';
                    }
                } else {
                    characterArmor.style.display = 'none';
                }

                // Update name
                const displayName = characterName || classInfo.name;
                characterNameDisplay.textContent = displayName;
                headerName.textContent = displayName;
                statsName.textContent = displayName;

                // Update level
                characterLevelDisplay.textContent = `Уровень ${characterLevel}`;
                headerLevel.textContent = `Уровень ${characterLevel}`;
                statsClass.textContent = `${classInfo.name} - Уровень ${characterLevel}`;

                // Update stats
                const health = classInfo.stats.health + (parseInt(vitalityValue.textContent) - 5) * 5;
                const mana = classInfo.stats.mana + (parseInt(intellectValue.textContent) - 5) * 3;

                healthValue.textContent = `${health} / ${health}`;
                manaValue.textContent = `${mana} / ${mana}`;
                xpValue.textContent = `${characterXP} / ${xpToNextLevel}`;

                healthBar.style.width = '100%';
                manaBar.style.width = '100%';
                xpBar.style.width = `${(characterXP / xpToNextLevel) * 100}%`;

                // Update gold
                goldAmount.textContent = gold;

                // Update equipment slots
                updateEquipmentSlots();

                // Update derived stats
                updateDerivedStats();

                // Update buffs
                renderBuffs();
            }

            // Update Equipment Slots
            function updateEquipmentSlots() {
                if (equipped.weapon) {
                    const weapon = itemsData.weapons.find(w => w.id === equipped.weapon);
                    weaponSlot.textContent = weapon.icon;
                } else {
                    weaponSlot.textContent = "";
                }

                if (equipped.armor) {
                    const armor = itemsData.armor.find(a => a.id === equipped.armor);
                    armorSlot.textContent = armor.icon;
                } else {
                    armorSlot.textContent = "";
                }
            }

            // Render Buffs
            function renderBuffs() {
                buffsContainer.innerHTML = '';

                playerBuffs.forEach(buff => {
                    const buffElement = document.createElement('div');
                    buffElement.className = 'buff';
                    buffElement.innerHTML = `${buff.icon} ${buff.name}: +${buff.value} ${getStatName(buff.stat)}`;
                    buffsContainer.appendChild(buffElement);
                });
            }

            // Get Stat Name
            function getStatName(stat) {
                const statNames = {
                    'strength': 'Сила',
                    'agility': 'Ловкость',
                    'vitality': 'Живучесть',
                    'intellect': 'Интеллект',
                    'defense': 'Защита',
                    'crit': 'Крит'
                };
                return statNames[stat] || stat;
            }

            // Render Skills
            function renderSkills(className) {
                skillsGrid.innerHTML = '';
                const skills = classData[className].skills;

                skills.forEach(skill => {
                    const skillCard = document.createElement('div');
                    skillCard.className = 'skill-card';

                    skillCard.innerHTML = `
                        ${skill.level > 0 ? `<div class="skill-level">${skill.level}</div>` : ''}
                        <div class="skill-icon" style="background-image: ${skill.icon}"></div>
                        <div class="skill-name">${skill.name}</div>
                        <div class="skill-desc">${skill.desc}</div>
                        <div class="skill-cost">${skill.cost}</div>
                        ${skill.level > 0 || characterLevel >= (skill.reqLevel || 1) ? `
                            <button class="skill-upgrade" ${skill.level >= skill.maxLevel || skillPoints <= 0 ? 'disabled' : ''}>
                                ${skill.level === 0 ? 'Изучить' : 'Улучшить'} (${skill.level}/${skill.maxLevel})
                            </button>
                        ` : `<div class="skill-level-req">Требуется уровень: ${skill.reqLevel}</div>`}
                    `;

                    // Add event listener for upgrade button if applicable
                    if (skill.level > 0 || characterLevel >= (skill.reqLevel || 1)) {
                        const upgradeBtn = skillCard.querySelector('.skill-upgrade');
                        if (upgradeBtn) {
                            upgradeBtn.addEventListener('click', function() {
                                if (skillPoints <= 0) return;
                                if (skill.level >= skill.maxLevel) return;

                                skill.level++;
                                skillPoints--;
                                renderSkills(currentClass);

                                if (skillPoints <= 0) {
                                    document.querySelectorAll('.skill-upgrade').forEach(btn => {
                                        if (!btn.disabled) btn.disabled = true;
                                    });
                                }
                            });
                        }
                    }

                    skillsGrid.appendChild(skillCard);
                });
            }

            // Render Shop
            function renderShop() {
                shopItems.innerHTML = '';

                // Render weapons
                itemsData.weapons.forEach(weapon => {
                    if (weapon.reqLevel > characterLevel) return;

                    const shopItem = document.createElement('div');
                    shopItem.className = 'shop-item';
                    shopItem.innerHTML = `
                        <div class="item-icon">${weapon.icon}</div>
                        <div class="item-name">${weapon.name}</div>
                        <div class="item-desc">Атака: ${weapon.attack}${weapon.magic ? `<br>Магия: ${weapon.magic}` : ''}</div>
                        <div class="item-price">${weapon.price} золота</div>
                        <button class="buy-btn" data-id="${weapon.id}" data-type="weapon">Купить</button>
                    `;

                    shopItems.appendChild(shopItem);
                });

                // Render armor
                itemsData.armor.forEach(armor => {
                    if (armor.reqLevel > characterLevel) return;

                    const shopItem = document.createElement('div');
                    shopItem.className = 'shop-item';
                    shopItem.innerHTML = `
                        <div class="item-icon">${armor.icon}</div>
                        <div class="item-name">${armor.name}</div>
                        <div class="item-desc">Защита: ${armor.defense}${armor.magic ? `<br>Магия: +${armor.magic}` : ''}</div>
                        <div class="item-price">${armor.price} золота</div>
                        <button class="buy-btn" data-id="${armor.id}" data-type="armor">Купить</button>
                    `;

                    shopItems.appendChild(shopItem);
                });

                // Render consumables
                itemsData.consumables.forEach(consumable => {
                    const shopItem = document.createElement('div');
                    shopItem.className = 'shop-item';
                    shopItem.innerHTML = `
                        <div class="item-icon">${consumable.icon}</div>
                        <div class="item-name">${consumable.name}</div>
                        <div class="item-desc">Восстанавливает: ${consumable.effect.health ? 'Здоровье' : 'Мана'}</div>
                        <div class="item-price">${consumable.price} золота</div>
                        <button class="buy-btn" data-id="${consumable.id}" data-type="consumable">Купить</button>
                    `;

                    shopItems.appendChild(shopItem);
                });

                // Render materials
                itemsData.materials.forEach(material => {
                    const shopItem = document.createElement('div');
                    shopItem.className = 'shop-item';
                    shopItem.innerHTML = `
                        <div class="item-icon">${material.icon}</div>
                        <div class="item-name">${material.name}</div>
                        <div class="item-desc">Материал для крафта</div>
                        <div class="item-price">${material.price} золота</div>
                        <button class="buy-btn" data-id="${material.id}" data-type="material">Купить</button>
                    `;

                    shopItems.appendChild(shopItem);
                });

                // Add event listeners to buy buttons
                document.querySelectorAll('.buy-btn').forEach(btn => {
                    btn.addEventListener('click', function() {
                        const id = this.getAttribute('data-id');
                        const type = this.getAttribute('data-type');
                        buyItem(id, type);
                    });
                });
            }

            // Render Blacksmith
            function renderBlacksmith() {
                renderUpgradeItems();
                renderDismantleItems();
            }

            // Render Upgrade Items
            function renderUpgradeItems() {
                upgradeItems.innerHTML = '';

                craftingData.filter(recipe => recipe.type === 'upgrade').forEach(recipe => {
                    const blacksmithItem = document.createElement('div');
                    blacksmithItem.className = 'blacksmith-item';

                    // Check if player has materials
                    const canCraft = checkCraftingMaterials(recipe);
                    const resultItem = [...itemsData.weapons, ...itemsData.armor].find(i => i.id === recipe.result);

                    if (!resultItem) return;

                    blacksmithItem.innerHTML = `
                        <div class="item-icon">${recipe.icon}</div>
                        <div class="item-name">${recipe.name}</div>
                        <div class="item-desc">Создает: ${resultItem.name}<br>${getRecipeDescription(recipe)}</div>
                        <div class="item-price">${recipe.price} золота</div>
                        <button class="craft-btn" data-id="${recipe.id}" ${!canCraft ? 'disabled' : ''}>Создать</button>
                    `;

                    upgradeItems.appendChild(blacksmithItem);
                });

                // Add event listeners to craft buttons
                document.querySelectorAll('#upgrade-content .craft-btn').forEach(btn => {
                    btn.addEventListener('click', function() {
                        const id = this.getAttribute('data-id');
                        craftItem(id);
                    });
                });
            }

            // Render Dismantle Items
            function renderDismantleItems() {
                dismantleItems.innerHTML = '';

                // Show weapons and armor that can be dismantled
                const dismantleableItems = inventory.filter(item => item.type === 'weapon' || item.type === 'armor');

                if (dismantleableItems.length === 0) {
                    dismantleItems.innerHTML = '<p>У вас нет предметов для разборки</p>';
                    return;
                }

                dismantleableItems.forEach((item, index) => {
                    const blacksmithItem = document.createElement('div');
                    blacksmithItem.className = 'blacksmith-item';

                    // Calculate materials from dismantling (higher quality gives more materials)
                    let materials = [];
                    if (item.quality === 'common') {
                        materials = [{ id: "m1", count: 1 }, { id: "m2", count: 1 }];
                    } else if (item.quality === 'uncommon') {
                        materials = [{ id: "m1", count: 2 }, { id: "m2", count: 2 }, { id: "m3", count: 1 }];
                    } else if (item.quality === 'rare') {
                        materials = [{ id: "m1", count: 3 }, { id: "m2", count: 3 }, { id: "m3", count: 2 }];
                    } else if (item.quality === 'epic') {
                        materials = [{ id: "m1", count: 5 }, { id: "m2", count: 5 }, { id: "m3", count: 3 }, { id: "m4", count: 1 }];
                    } else if (item.quality === 'legendary') {
                        materials = [{ id: "m1", count: 8 }, { id: "m2", count: 8 }, { id: "m3", count: 5 }, { id: "m4", count: 3 }];
                    }

                    const materialsDesc = materials.map(m => {
                        const material = itemsData.materials.find(mat => mat.id === m.id);
                        return `${material.name} x${m.count}`;
                    }).join(', ');

                    blacksmithItem.innerHTML = `
                        <div class="item-icon">${item.icon}</div>
                        <div class="item-name">${item.name}</div>
                        <div class="item-desc">При разборке получите:<br>${materialsDesc}</div>
                        <button class="dismantle-btn" data-index="${index}">Разобрать</button>
                    `;

                    dismantleItems.appendChild(blacksmithItem);
                });

                // Add event listeners to dismantle buttons
                document.querySelectorAll('#dismantle-content .dismantle-btn').forEach(btn => {
                    btn.addEventListener('click', function() {
                        const index = parseInt(this.getAttribute('data-index'));
                        dismantleItem(index);
                    });
                });
            }

            // Check Crafting Materials
            function checkCraftingMaterials(recipe) {
                for (const material of recipe.materials) {
                    const itemCount = inventory.filter(item => item.id === material.id).length;
                    if (itemCount < material.count) {
                        return false;
                    }
                }
                return gold >= recipe.price;
            }

            // Get Recipe Description
            function getRecipeDescription(recipe) {
                let desc = "Материалы: ";
                recipe.materials.forEach((material, index) => {
                    const item = [...itemsData.weapons, ...itemsData.armor, ...itemsData.consumables, ...itemsData.materials].find(i => i.id === material.id);
                    if (item) {
                        desc += `${item.name} x${material.count}`;
                        if (index < recipe.materials.length - 1) {
                            desc += ", ";
                        }
                    }
                });
                return desc;
            }

            // Render Locations
            function renderLocations() {
                locationsGrid.innerHTML = '';

                locationsData.forEach(location => {
                    const locationCard = document.createElement('div');
                    locationCard.className = 'location';

                    locationCard.innerHTML = `
                        <div class="location-name">${location.name}</div>
                        <div class="location-type">${location.type}</div>
                        <div class="location-level">Уровень локации: ${location.reqLevel}</div>
                        <div class="location-desc">${location.desc}</div>
                        <div class="monsters-list">
                            ${location.monsters.map(monster => `
                                <div class="monster">
                                    <span>${monster.icon} ${monster.name}</span>
                                    <span>Уровень: ${location.reqLevel}</span>
                                </div>
                            `).join('')}
                        </div>
                        <button class="location-btn" data-id="${location.id}">Отправиться</button>
                    `;

                    locationsGrid.appendChild(locationCard);
                });

                // Add event listeners to location buttons
                document.querySelectorAll('.location-btn').forEach(btn => {
                    btn.addEventListener('click', function() {
                        const id = this.getAttribute('data-id');
                        enterLocation(id);
                    });
                });
            }

            // Enter Location
            function enterLocation(id) {
                currentLocation = locationsData.find(l => l.id === id);
                if (!currentLocation) return;

                if (characterLevel < currentLocation.reqLevel) {
                    alert(`Для посещения этой локации требуется уровень ${currentLocation.reqLevel}!`);
                    return;
                }

                // Render location map
                renderLocationMap();

                // Switch to location tab
                tabButtons.forEach(btn => btn.classList.remove('active'));
                tabContents.forEach(content => content.classList.remove('active'));

                document.querySelector('.tab-btn[data-tab="location"]').classList.add('active');
                document.getElementById('location').classList.add('active');
            }

            // Render Location Map
            function renderLocationMap() {
                locationMap.innerHTML = '';

                // Create a simple 5x5 grid for the location
                const mapSize = 5;
                const cellSize = 60;
                const padding = 20;

                // Calculate center position
                const centerX = (locationMap.offsetWidth - (mapSize * cellSize)) / 2;
                const centerY = (locationMap.offsetHeight - (mapSize * cellSize)) / 2;

                for (let y = 0; y < mapSize; y++) {
                    for (let x = 0; x < mapSize; x++) {
                        const cell = document.createElement('div');
                        cell.className = 'map-cell empty';
                        cell.style.left = `${centerX + x * cellSize}px`;
                        cell.style.top = `${centerY + y * cellSize}px`;

                        // Randomly place player, monsters, treasures and exit
                        if (x === 2 && y === 2) {
                            cell.className = 'map-cell player';
                            cell.textContent = '👤';
                            cell.title = 'Ваш персонаж';
                        } else if (Math.random() < 0.2) {
                            // Place a monster
                            const randomMonster = currentLocation.monsters[Math.floor(Math.random() * currentLocation.monsters.length)];
                            cell.className = 'map-cell monster';
                            cell.textContent = randomMonster.icon;
                            cell.setAttribute('data-monster', JSON.stringify(randomMonster));
                            cell.title = randomMonster.name;
                        } else if (Math.random() < 0.1) {
                            // Place a treasure
                            cell.className = 'map-cell treasure';
                            cell.textContent = '💰';
                            cell.title = 'Сундук с сокровищами';
                        } else if (x === mapSize-1 && y === mapSize-1) {
                            // Place exit
                            cell.className = 'map-cell exit';
                            cell.textContent = '🚪';
                            cell.title = 'Выход';
                        }

                        cell.addEventListener('click', handleMapCellClick);
                        locationMap.appendChild(cell);
                    }
                }
            }

            // Handle Map Cell Click
            function handleMapCellClick(event) {
                const cell = event.currentTarget;

                if (cell.classList.contains('monster')) {
                    const monsterData = JSON.parse(cell.getAttribute('data-monster'));
                    startCombat(monsterData);
                } else if (cell.classList.contains('treasure')) {
                    // Open treasure
                    openTreasure(cell);
                } else if (cell.classList.contains('exit')) {
                    // Exit location
                    exitLocation();
                } else if (cell.classList.contains('empty')) {
                    // Move player to this cell
                    movePlayer(cell);
                }
            }

            // Move Player
            function movePlayer(targetCell) {
                document.querySelectorAll('.map-cell.player').forEach(c => c.classList.remove('player'));
                targetCell.classList.add('player');
                targetCell.textContent = '👤';
                targetCell.title = 'Ваш персонаж';

                // Small chance to find an item when moving to an empty cell
                if (Math.random() < 0.1) {
                    const randomItem = itemsData.consumables[Math.floor(Math.random() * itemsData.consumables.length)];
                    addToInventory(randomItem);
                    alert(`Вы нашли: ${randomItem.name}`);
                    renderInventory();
                }
            }

            // Open Treasure
            function openTreasure(cell) {
                cell.classList.remove('treasure');
                cell.classList.add('empty');
                cell.textContent = '';
                cell.title = '';

                // Generate treasure loot
                const goldFound = Math.floor(Math.random() * 20) + 10;
                gold += goldFound;

                // Chance to find an item
                let itemFound = null;
                if (Math.random() < 0.7) {
                    const possibleItems = [...itemsData.consumables, ...itemsData.materials];
                    itemFound = possibleItems[Math.floor(Math.random() * possibleItems.length)];
                    addToInventory(itemFound);
                }

                // Show treasure results
                let message = `Вы нашли ${goldFound} золота!`;
                if (itemFound) {
                    message += ` и ${itemFound.name}`;
                }

                alert(message);
                updateCharacterPreview();
            }

            // Exit Location
            function exitLocation() {
                alert('Вы покидаете локацию');
                // Switch back to locations list
                renderLocations();
            }

            // Start Combat
            function startCombat(monster) {
                currentEnemy = {...monster};
                combatActive = true;

                // Update combat UI
                document.getElementById('player-combat-avatar').style.backgroundImage = classData[currentClass].baseImage;
                document.getElementById('enemy-combat-avatar').style.backgroundImage = currentEnemy.image;

                const playerHealth = healthValue.textContent;
                document.getElementById('player-combat-health').textContent = playerHealth;
                document.getElementById('player-health-bar').style.width = '100%';

                document.getElementById('enemy-combat-health').textContent = `${currentEnemy.health}/${currentEnemy.maxHealth}`;
                document.getElementById('enemy-health-bar').style.width = '100%';

                document.getElementById('combat-log').innerHTML = `<div class="log-entry">Вы встретили ${currentEnemy.name}!</div>`;

                // Render player skills
                renderCombatSkills();

                // Add combat event listeners
                document.getElementById('attack-btn').addEventListener('click', playerAttack);
                document.getElementById('skill-btn').addEventListener('click', openSkillsMenu);
                document.getElementById('item-btn').addEventListener('click', openItemsMenu);
                document.getElementById('flee-btn').addEventListener('click', attemptFlee);

                // Switch to combat tab
                tabButtons.forEach(btn => btn.classList.remove('active'));
                tabContents.forEach(content => content.classList.remove('active'));

                document.querySelector('.tab-btn[data-tab="combat"]').classList.add('active');
                document.getElementById('combat').classList.add('active');
            }

            // Render Combat Skills
            function renderCombatSkills() {
                const skillsContainer = document.getElementById('player-combat-skills');
                skillsContainer.innerHTML = '';

                const skills = classData[currentClass].skills.filter(skill => skill.level > 0);

                skills.forEach(skill => {
                    const skillElement = document.createElement('div');
                    skillElement.className = 'combat-skill';
                    skillElement.style.backgroundImage = skill.icon;
                    skillElement.title = `${skill.name}: ${skill.desc}`;

                    skillElement.addEventListener('click', () => useSkill(skill));
                    skillsContainer.appendChild(skillElement);
                });
            }

            // Use Skill
            function useSkill(skill) {
                if (!combatActive) return;

                // Get mana cost
                const manaCost = parseInt(skill.cost.split(' ')[0]);
                const currentMana = parseInt(manaValue.textContent.split('/')[0]);

                if (currentMana < manaCost) {
                    alert('Недостаточно маны!');
                    return;
                }

                // Deduct mana
                const maxMana = parseInt(manaValue.textContent.split('/')[1]);
                const newMana = currentMana - manaCost;
                manaValue.textContent = `${newMana} / ${maxMana}`;
                manaBar.style.width = `${(newMana / maxMana) * 100}%`;

                // Implement skill effects based on skill type
                let damage = 0;
                let message = '';

                if (skill.type === 'attack') {
                    // Calculate damage
                    const attackValue = document.getElementById('attack-value').textContent;
                    const [minAttack, maxAttack] = attackValue.split('-').map(Number);
                    const baseDamage = Math.floor(Math.random() * (maxAttack - minAttack + 1)) + minAttack;

                    if (skill.effect.damageMultiplier) {
                        damage = Math.floor(baseDamage * skill.effect.damageMultiplier);
                    } else if (skill.effect.damage) {
                        const [min, max] = skill.effect.damage;
                        damage = Math.floor(Math.random() * (max - min + 1)) + min;
                    }

                    // Apply damage to enemy
                    currentEnemy.health -= damage;
                    message = `Вы используете ${skill.name} и наносите ${damage} урона!`;

                } else if (skill.type === 'buff') {
                    // Apply buff to player
                    const buff = buffsData.find(b => b.stat === skill.effect.stat);
                    if (buff) {
                        applyBuff({...buff, value: skill.effect.value * (skill.level || 1), duration: skill.effect.duration});
                        message = `Вы используете ${skill.name} и получаете бафф!`;
                    }
                } else if (skill.type === 'defense') {
                    // Apply defense effect
                    message = `Вы используете ${skill.name} и готовитесь к защите!`;
                }

                // Update combat log
                const combatLog = document.getElementById('combat-log');
                combatLog.innerHTML += `<div class="log-entry">${message}</div>`;
                combatLog.scrollTop = combatLog.scrollHeight;

                // Update enemy health
                const enemyHealthPercent = (currentEnemy.health / currentEnemy.maxHealth) * 100;
                document.getElementById('enemy-health-bar').style.width = `${enemyHealthPercent}%`;
                document.getElementById('enemy-combat-health').textContent = `${currentEnemy.health}/${currentEnemy.maxHealth}`;

                // Check if enemy is defeated
                if (currentEnemy.health <= 0) {
                    enemyDefeated();
                    return;
                }

                // Enemy attacks back after a delay
                setTimeout(enemyAttack, 1000);
            }

            // Open Skills Menu
            function openSkillsMenu() {
                // This would open a modal with skills list
                alert('Выберите умение для использования');
            }

            // Open Items Menu
            function openItemsMenu() {
                // This would open a modal with inventory items
                alert('Выберите предмет для использования');
            }

            // Player Attack
            function playerAttack() {
                if (!combatActive) return;

                const attackBtn = document.getElementById('attack-btn');
                attackBtn.disabled = true;

                // Calculate player damage
                const attackValue = document.getElementById('attack-value').textContent;
                const [minAttack, maxAttack] = attackValue.split('-').map(Number);
                const damage = Math.floor(Math.random() * (maxAttack - minAttack + 1)) + minAttack;

                // Apply damage to enemy
                currentEnemy.health -= damage;

                // Update combat log
                const combatLog = document.getElementById('combat-log');
                combatLog.innerHTML += `<div class="log-entry">Вы нанесли ${damage} урона ${currentEnemy.name}!</div>`;
                combatLog.scrollTop = combatLog.scrollHeight;

                // Update enemy health
                const enemyHealthPercent = (currentEnemy.health / currentEnemy.maxHealth) * 100;
                document.getElementById('enemy-health-bar').style.width = `${enemyHealthPercent}%`;
                document.getElementById('enemy-combat-health').textContent = `${currentEnemy.health}/${currentEnemy.maxHealth}`;

                // Check if enemy is defeated
                if (currentEnemy.health <= 0) {
                    enemyDefeated();
                    attackBtn.disabled = false;
                    return;
                }

                // Enemy attacks back after a delay
                setTimeout(enemyAttack, 1000);
            }

            // Enemy Attack
            function enemyAttack() {
                if (!combatActive) return;

                // Calculate enemy damage
                const [minAttack, maxAttack] = currentEnemy.attack.split('-').map(Number);
                const damage = Math.floor(Math.random() * (maxAttack - minAttack + 1)) + minAttack;

                // Get player current health
                const playerHealth = healthValue.textContent.split('/').map(Number);
                let currentHealth = playerHealth[0];
                const maxHealth = playerHealth[1];

                // Apply damage to player
                currentHealth -= damage;

                // Update combat log
                const combatLog = document.getElementById('combat-log');
                combatLog.innerHTML += `<div class="log-entry">${currentEnemy.name} нанес вам ${damage} урона!</div>`;
                combatLog.scrollTop = combatLog.scrollHeight;

                // Update player health
                healthValue.textContent = `${currentHealth}/${maxHealth}`;
                const healthPercent = (currentHealth / maxHealth) * 100;
                healthBar.style.width = `${healthPercent}%`;
                document.getElementById('player-health-bar').style.width = `${healthPercent}%`;
                document.getElementById('player-combat-health').textContent = `${currentHealth}/${maxHealth}`;

                // Check if player is defeated
                if (currentHealth <= 0) {
                    playerDefeated();
                    return;
                }

                // Re-enable attack button
                document.getElementById('attack-btn').disabled = false;
            }

            // Enemy Defeated
            function enemyDefeated() {
                combatActive = false;

                // Calculate rewards
                const expGain = currentEnemy.exp;
                const goldGain = Math.floor(Math.random() * (currentEnemy.gold.split('-').map(Number)[1] - currentEnemy.gold.split('-').map(Number)[0] + 1)) + currentEnemy.gold.split('-').map(Number)[0];

                // Add rewards
                addXP(expGain);
                gold += goldGain;

                // Generate loot
                generateLoot();

                // Update combat log
                const combatLog = document.getElementById('combat-log');
                combatLog.innerHTML += `<div class="log-entry">Вы победили ${currentEnemy.name} и получили ${expGain} опыта и ${goldGain} золота!</div>`;
                combatLog.scrollTop = combatLog.scrollHeight;

                // Show loot screen
                showLootScreen();
            }

            // Generate Loot
            function generateLoot() {
                currentLoot = [];

                // Always give some gold
                currentLoot.push({ type: 'gold', amount: Math.floor(Math.random() * 10) + 5 });

                // Chance to get items based on location loot table
                currentLocation.loot.forEach(itemId => {
                    // Higher chance for common items, lower for rare ones
                    let chance = 0.3; // 30% base chance

                    // Adjust chance based on item quality
                    const item = [...itemsData.weapons, ...itemsData.armor, ...itemsData.consumables, ...itemsData.materials].find(i => i.id === itemId);
                    if (item) {
                        if (item.quality === 'uncommon') chance = 0.15;
                        else if (item.quality === 'rare') chance = 0.07;
                        else if (item.quality === 'epic') chance = 0.03;
                        else if (item.quality === 'legendary') chance = 0.01;

                        if (Math.random() < chance) {
                            currentLoot.push({ type: 'item', item: { ...item } });
                        }
                    }
                });

                // Chance to get a random buff
                if (Math.random() < 0.1) {
                    const randomBuff = buffsData[Math.floor(Math.random() * buffsData.length)];
                    currentLoot.push({ type: 'buff', buff: { ...randomBuff } });
                }
            }

            // Show Loot Screen
            function showLootScreen() {
                const lootItems = document.getElementById('loot-items');
                lootItems.innerHTML = '';

                currentLoot.forEach(loot => {
                    const lootElement = document.createElement('div');

                    if (loot.type === 'gold') {
                        lootElement.className = 'loot-item';
                        lootElement.innerHTML = `
                            <div class="item-icon">🪙</div>
                            <div class="item-name">${loot.amount} золота</div>
                        `;
                    } else if (loot.type === 'item') {
                        lootElement.className = `loot-item loot-quality-${loot.item.quality}`;
                        lootElement.innerHTML = `
                            <div class="item-icon">${loot.item.icon}</div>
                            <div class="item-name">${loot.item.name}</div>
                        `;
                    } else if (loot.type === 'buff') {
                        lootElement.className = 'loot-item';
                        lootElement.innerHTML = `
                            <div class="item-icon">${loot.buff.icon}</div>
                            <div class="item-name">${loot.buff.name}</div>
                        `;
                    }

                    lootItems.appendChild(lootElement);
                });

                // Add event listener to take loot button
                document.getElementById('take-loot-btn').addEventListener('click', takeAllLoot);

                // Switch to loot tab
                tabButtons.forEach(btn => btn.classList.remove('active'));
                tabContents.forEach(content => content.classList.remove('active'));

                document.querySelector('.tab-btn[data-tab="loot"]').classList.add('active');
                document.getElementById('loot').classList.add('active');
            }

            // Take All Loot
            function takeAllLoot() {
                currentLoot.forEach(loot => {
                    if (loot.type === 'gold') {
                        gold += loot.amount;
                    } else if (loot.type === 'item') {
                        addToInventory(loot.item);
                    } else if (loot.type === 'buff') {
                        // Apply buff to player
                        applyBuff(loot.buff);
                    }
                });

                // Return to location
                enterLocation(currentLocation.id);

                // Update UI
                updateCharacterPreview();
                renderInventory();
            }

            // Apply Buff
            function applyBuff(buff) {
                // Check if player already has this buff
                const existingBuffIndex = playerBuffs.findIndex(b => b.id === buff.id);

                if (existingBuffIndex !== -1) {
                    // Refresh duration of existing buff
                    playerBuffs[existingBuffIndex].duration = buff.duration;
                } else {
                    // Add new buff
                    playerBuffs.push({ ...buff });
                }

                // Update derived stats
                updateDerivedStats();
            }

            // Player Defeated
            function playerDefeated() {
                combatActive = false;

                // Update combat log
                const combatLog = document.getElementById('combat-log');
                combatLog.innerHTML += `<div class="log-entry">Вы потерпели поражение! Вы теряете часть золота.</div>`;
                combatLog.scrollTop = combatLog.scrollHeight;

                // Penalty
                gold = Math.max(0, gold - Math.floor(gold * 0.1));

                // Add exit button
                const combatActions = document.querySelector('.combat-actions');
                combatActions.innerHTML = '<button class="combat-btn" id="exit-combat-btn">Вернуться</button>';

                document.getElementById('exit-combat-btn').addEventListener('click', exitCombat);
            }

            // Attempt Flee
            function attemptFlee() {
                if (!combatActive) return;

                const fleeChance = 0.7; // 70% chance to flee
                if (Math.random() < fleeChance) {
                    // Successful flee
                    combatActive = false;

                    // Update combat log
                    const combatLog = document.getElementById('combat-log');
                    combatLog.innerHTML += `<div class="log-entry">Вы успешно сбежали!</div>`;
                    combatLog.scrollTop = combatLog.scrollHeight;

                    // Add exit button
                    const combatActions = document.querySelector('.combat-actions');
                    combatActions.innerHTML = '<button class="combat-btn" id="exit-combat-btn">Вернуться</button>';

                    document.getElementById('exit-combat-btn').addEventListener('click', exitCombat);
                } else {
                    // Failed flee
                    const combatLog = document.getElementById('combat-log');
                    combatLog.innerHTML += `<div class="log-entry">Вам не удалось сбежать!</div>`;
                    combatLog.scrollTop = combatLog.scrollHeight;

                    // Enemy attacks
                    setTimeout(enemyAttack, 1000);
                }
            }

            // Exit Combat
            function exitCombat() {
                // Switch back to locations tab
                tabButtons.forEach(btn => btn.classList.remove('active'));
                tabContents.forEach(content => content.classList.remove('active'));

                document.querySelector('.tab-btn[data-tab="location"]').classList.add('active');
                document.getElementById('location').classList.add('active');

                // Reset combat UI
                document.getElementById('combat-log').innerHTML = '';
                document.querySelector('.combat-actions').innerHTML = `
                    <button class="combat-btn attack" id="attack-btn">Атака</button>
                    <button class="combat-btn" id="skill-btn">Умение</button>
                    <button class="combat-btn" id="item-btn">Предмет</button>
                    <button class="combat-btn" id="flee-btn">Бегство</button>
                `;

                // Update character UI
                updateCharacterPreview();
            }

            // Buy Item
            function buyItem(id, type) {
                let item;

                if (type === 'weapon') {
                    item = itemsData.weapons.find(w => w.id === id);
                } else if (type === 'armor') {
                    item = itemsData.armor.find(a => a.id === id);
                } else if (type === 'consumable') {
                    item = itemsData.consumables.find(c => c.id === id);
                } else if (type === 'material') {
                    item = itemsData.materials.find(m => m.id === id);
                }

                if (!item) return;

                if (gold < item.price) {
                    alert('Недостаточно золота!');
                    return;
                }

                gold -= item.price;
                addToInventory(item);

                alert(`Вы купили: ${item.name}`);
                updateCharacterPreview();
                renderShop();
                renderInventory();
            }

            // Craft Item
            function craftItem(id) {
                const recipe = craftingData.find(r => r.id === id);
                if (!recipe) return;

                if (!checkCraftingMaterials(recipe)) {
                    alert('Недостаточно материалов!');
                    return;
                }

                // Remove materials
                for (const material of recipe.materials) {
                    for (let i = 0; i < material.count; i++) {
                        const index = inventory.findIndex(item => item.id === material.id);
                        if (index !== -1) {
                            inventory.splice(index, 1);
                        }
                    }
                }

                // Deduct gold
                gold -= recipe.price;

                // Add result item
                const resultItem = [...itemsData.weapons, ...itemsData.armor, ...itemsData.consumables].find(i => i.id === recipe.result);
                if (resultItem) {
                    addToInventory(resultItem);
                    alert(`Вы создали: ${resultItem.name}`);
                }

                updateCharacterPreview();
                renderInventory();
                renderBlacksmith();
            }

            // Dismantle Item
            function dismantleItem(index) {
                const item = inventory[index];

                // Calculate materials from dismantling (higher quality gives more materials)
                let materials = [];
                if (item.quality === 'common') {
                    materials = [{ id: "m1", count: 1 }, { id: "m2", count: 1 }];
                } else if (item.quality === 'uncommon') {
                    materials = [{ id: "m1", count: 2 }, { id: "m2", count: 2 }, { id: "m3", count: 1 }];
                } else if (item.quality === 'rare') {
                    materials = [{ id: "m1", count: 3 }, { id: "m2", count: 3 }, { id: "m3", count: 2 }];
                } else if (item.quality === 'epic') {
                    materials = [{ id: "m1", count: 5 }, { id: "m2", count: 5 }, { id: "m3", count: 3 }, { id: "m4", count: 1 }];
                } else if (item.quality === 'legendary') {
                    materials = [{ id: "m1", count: 8 }, { id: "m2", count: 8 }, { id: "m3", count: 5 }, { id: "m4", count: 3 }];
                }

                // Remove item from inventory
                inventory.splice(index, 1);

                // Add materials to inventory
                materials.forEach(material => {
                    for (let i = 0; i < material.count; i++) {
                        const matItem = itemsData.materials.find(m => m.id === material.id);
                        if (matItem) {
                            inventory.push({...matItem});
                        }
                    }
                });

                // Show message
                const materialsList = materials.map(m => {
                    const material = itemsData.materials.find(mat => mat.id === m.id);
                    return `${material.name} x${m.count}`;
                }).join(', ');

                alert(`Вы разобрали ${item.name} и получили: ${materialsList}`);

                // Update UI
                updateCharacterPreview();
                renderInventory();
                renderBlacksmith();
            }

            // Add to Inventory
            function addToInventory(item) {
                inventory.push({...item});
                renderInventory();
            }

            // Render Inventory
            function renderInventory() {
                inventoryGrid.innerHTML = '';

                for (let i = 0; i < 10; i++) {
                    const slot = document.createElement('div');

                    if (i < inventory.length) {
                        const item = inventory[i];
                        slot.className = 'item-slot';
                        if (equipped.weapon === item.id || equipped.armor === item.id) {
                            slot.classList.add('equipped');
                        }
                        slot.innerHTML = `
                            <div class="item-icon">${item.icon}</div>
                            <div class="item-count">1</div>
                        `;

                        // Add click event to use/equip item
                        slot.addEventListener('click', (e) => {
                            // Show context menu
                            showContextMenu(e, i);
                        });
                    } else {
                        slot.className = 'item-slot empty';
                    }

                    inventoryGrid.appendChild(slot);
                }
            }

            // Show Context Menu
            function showContextMenu(event, index) {
                const item = inventory[index];
                if (!item) return;

                // Position context menu
                contextMenu.style.display = 'flex';
                contextMenu.style.left = `${event.pageX}px`;
                contextMenu.style.top = `${event.pageY}px`;

                // Store the item index
                contextMenuItemIndex = index;

                // Update context menu buttons based on item type
                const useBtn = contextMenu.querySelector('.use');
                const equipBtn = contextMenu.querySelector('.equip');
                const sellBtn = contextMenu.querySelector('.sell');
                const dismantleBtn = contextMenu.querySelector('.dismantle');

                // Show/hide buttons based on item type
                if (item.type === 'consumable') {
                    useBtn.style.display = 'block';
                    equipBtn.style.display = 'none';
                } else if (item.type === 'weapon' || item.type === 'armor') {
                    useBtn.style.display = 'none';
                    equipBtn.style.display = 'block';

                    // Change equip text if already equipped
                    if (equipped.weapon === item.id || equipped.armor === item.id) {
                        equipBtn.textContent = 'Снять';
                    } else {
                        equipBtn.textContent = 'Экипировать';
                    }
                } else {
                    useBtn.style.display = 'none';
                    equipBtn.style.display = 'none';
                }

                // Always show sell and dismantle buttons for appropriate items
                sellBtn.style.display = 'block';
                dismantleBtn.style.display = (item.type === 'weapon' || item.type === 'armor') ? 'block' : 'none';

                // Add event listeners
                useBtn.onclick = () => useItem(index);
                equipBtn.onclick = () => equipItem(index);
                sellBtn.onclick = () => sellItem(index);
                dismantleBtn.onclick = () => dismantleItem(index);

                // Hide context menu when clicking elsewhere
                setTimeout(() => {
                    document.addEventListener('click', hideContextMenu);
                }, 100);
            }

            // Hide Context Menu
            function hideContextMenu() {
                contextMenu.style.display = 'none';
                document.removeEventListener('click', hideContextMenu);
            }

            // Use Item
            function useItem(index) {
                const item = inventory[index];

                if (item.type === 'consumable') {
                    // Use consumable
                    if (item.effect.health) {
                        // Heal player
                        const currentHealth = parseInt(healthValue.textContent.split('/')[0]);
                        const maxHealth = parseInt(healthValue.textContent.split('/')[1]);
                        const newHealth = Math.min(maxHealth, currentHealth + item.effect.health);

                        healthValue.textContent = `${newHealth} / ${maxHealth}`;
                        healthBar.style.width = `${(newHealth / maxHealth) * 100}%`;
                    } else if (item.effect.mana) {
                        // Restore mana
                        const currentMana = parseInt(manaValue.textContent.split('/')[0]);
                        const maxMana = parseInt(manaValue.textContent.split('/')[1]);
                        const newMana = Math.min(maxMana, currentMana + item.effect.mana);

                        manaValue.textContent = `${newMana} / ${maxMana}`;
                        manaBar.style.width = `${(newMana / maxMana) * 100}%`;
                    } else if (item.effect.buff) {
                        // Apply buff
                        const buff = buffsData.find(b => b.stat === item.effect.buff);
                        if (buff) {
                            applyBuff({...buff, value: item.effect.value, duration: item.effect.duration});
                            alert(`Вы получили бафф: ${buff.name}`);
                        }
                    }

                    // Remove from inventory
                    inventory.splice(index, 1);
                    renderInventory();

                }

                hideContextMenu();
            }

            // Equip Item
            function equipItem(index) {
                const item = inventory[index];

                if (item.type === 'weapon') {
                    // Equip weapon
                    if (equipped.weapon === item.id) {
                        // Unequip
                        equipped.weapon = null;
                    } else {
                        // Equip new weapon
                        if (equipped.weapon) {
                            // Return old weapon to inventory
                            const oldWeapon = itemsData.weapons.find(w => w.id === equipped.weapon);
                            if (oldWeapon) {
                                inventory.push(oldWeapon);
                            }
                        }
                        equipped.weapon = item.id;

                        // Remove from inventory
                        inventory.splice(index, 1);
                    }
                } else if (item.type === 'armor') {
                    // Equip armor
                    if (equipped.armor === item.id) {
                        // Unequip
                        equipped.armor = null;
                    } else {
                        // Equip new armor
                        if (equipped.armor) {
                            // Return old armor to inventory
                            const oldArmor = itemsData.armor.find(a => a.id === equipped.armor);
                            if (oldArmor) {
                                inventory.push(oldArmor);
                            }
                        }
                        equipped.armor = item.id;

                        // Remove from inventory
                        inventory.splice(index, 1);
                    }
                }

                renderInventory();
                updateEquipmentSlots();
                updateCharacterPreview();
                updateDerivedStats();

                hideContextMenu();
            }

            // Sell Item
            function sellItem(index) {
                const item = inventory[index];

                // Add gold
                gold += item.sellPrice;

                // Remove from inventory
                inventory.splice(index, 1);

                alert(`Вы продали: ${item.name} за ${item.sellPrice} золота`);
                updateCharacterPreview();
                renderInventory();

                hideContextMenu();
            }

            // Add XP
            function addXP(amount) {
                characterXP += amount;

                // Check for level up
                if (characterXP >= xpToNextLevel) {
                    levelUp();
                }

                // Update UI
                xpValue.textContent = `${characterXP} / ${xpToNextLevel}`;
                xpBar.style.width = `${(characterXP / xpToNextLevel) * 100}%`;
            }

            // Level Up
            function levelUp() {
                characterLevel++;
                characterXP -= xpToNextLevel;
                xpToNextLevel = Math.floor(xpToNextLevel * 1.5);

                // Award points
                statPoints += 2;
                skillPoints += 1;

                // Enable upgrade buttons
                upgradeButtons.forEach(btn => btn.disabled = false);

                // Show notification
                document.getElementById('level-number').textContent = characterLevel;
                levelUpNotification.classList.add('show');

                setTimeout(() => {
                    levelUpNotification.classList.remove('show');
                }, 3000);

                // Update UI
                updateCharacterPreview();
                renderSkills(currentClass);
                renderShop();
                renderLocations();

                // Check if we need to add more XP (multiple level ups)
                if (characterXP >= xpToNextLevel) {
                    levelUp();
                }
            }

            // Start Game Button
            startButton.addEventListener('click', function() {
                if (!characterName) {
                    alert('Пожалуйста, введите имя персонажа');
                    nicknameInput.focus();
                    return;
                }

                // Hide creation tab and button
                document.getElementById('creation').style.display = 'none';
                startButton.style.display = 'none';

                // Remove creation tab from tabs
                document.querySelector('.tab-btn[data-tab="creation"]').style.display = 'none';

                // Switch to stats tab
                tabButtons.forEach(btn => btn.classList.remove('active'));
                tabContents.forEach(content => content.classList.remove('active'));

                document.querySelector('.tab-btn[data-tab="stats"]').classList.add('active');
                document.getElementById('stats').classList.add('active');

                // Mark character as created
                characterCreated = true;

                // Start with empty inventory
                renderInventory();

                // Update UI
                updateCharacterPreview();

                alert(`Приключение начинается, ${characterName}!`);
            });

            // Buff timer (runs every second)
            setInterval(() => {
                if (playerBuffs.length > 0) {
                    // Update buff durations
                    playerBuffs.forEach(buff => {
                        buff.duration -= 1;
                    });

                    // Remove expired buffs
                    playerBuffs = playerBuffs.filter(buff => buff.duration > 0);

                    // Update derived stats
                    updateDerivedStats();
                }
            }, 1000);
        });
    </script>
</body>
</html>